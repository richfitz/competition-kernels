packages:
  - plant
  - rootSolve

sources:
  - R

plot_options:
  tall:
    height: 8
    width: 5.5

targets:
  all:
    depends:
      - plant_data
      - figures
      - figures_sm
      - ms/competition-kernels.pdf

  # NOTE: some issues getting dependencies to behave sensibly here
  # (manuscript rebuilding when figures change but tex does not)
  figures:
    depends:
      # - glob("ms/figures/*")
      - ms/figures/kernel.pdf
      - ms/figures/components.pdf
      - ms/figures/rstar.pdf
      - ms/figures/plant_hmat.pdf
      - ms/figures/plant_lma.pdf

  figures_sm:
    depends:
      - ms/figures/sm_rstar_components1.pdf
      - ms/figures/sm_rstar_components2.pdf
      - ms/figures/sm_rstar_abrams.pdf
      - ms/figures/sm_rstar_density.pdf
      - ms/figures/sm_plant_lma_components.pdf
      - ms/figures/sm_plant_hmat_components.pdf

  plant_data:
    depends:
      - plant_lma_1
      - plant_lma_2
      - plant_hmat_1
      - plant_hmat_2

  ms/competition-kernels.pdf:
    depends:
      - ms/references.bib
      - ms/ms.sty
      - ms/amnat.bst
    command: build_pdf("ms/competition-kernels.tex")

  # Data common to all _resident_ communities, but specific to one set
  # of parameter values.
  #
  # I'm pretty tempted to make these check: exists, because they are a
  # total hassle to regenerate and I don't think we should be doing
  # that lightly.
  plant_lma_shared:
    command: plant_competition_prepare(I("lma"), parallel=TRUE)
    quiet: false
  plant_hmat_shared:
    command: plant_competition_prepare(I("hmat"), parallel=TRUE)
    quiet: false

  plant_lma_1:
    command: plant_competition(0.2, plant_lma_shared)
  plant_lma_2:
    command: plant_competition(0.11, plant_lma_shared)
  plant_hmat_1:
    command: plant_competition(5.0, plant_hmat_shared)
  plant_hmat_2:
    command: plant_competition(17.0, plant_hmat_shared)

  ms/figures/kernel.pdf:
    command: fig_kernel()
    plot: true
  ms/figures/components.pdf:
    command: fig_components()
    plot: true
  ms/figures/rstar.pdf:
    command: fig_rstar()
    plot:
      height: 6
      width: 8
  ms/figures/plant_hmat.pdf:
    command: fig_plant_hmat(plant_hmat_1, plant_hmat_2)
    plot: true
  ms/figures/plant_lma.pdf:
    command: fig_plant_lma(plant_lma_1, plant_lma_2)
    plot: true

  ms/figures/sm_rstar_components1.pdf:
    command: fig_rstar_components(1)
    plot: tall
  ms/figures/sm_rstar_components2.pdf:
    command: fig_rstar_components(2)
    plot: tall
  ms/figures/sm_plant_lma_components.pdf:
    command: fig_plant_components(plant_lma_1, plant_lma_2)
    plot: tall
  ms/figures/sm_plant_hmat_components.pdf:
    command: fig_plant_components(plant_hmat_1, plant_hmat_2)
    plot: tall

  dat_rstar_abrams:
    command: rstar_add_abrams()
  ms/figures/sm_rstar_abrams.pdf:
    command: fig_rstar_abrams(dat_rstar_abrams)
    plot: true
  ms/figures/sm_rstar_density.pdf:
    command: fig_rstar_density()
    plot: true
