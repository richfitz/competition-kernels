\documentclass[a4paper,11pt]{article}
\usepackage[osf]{mathpazo}
\usepackage{ms}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage{caption}
\usepackage[labelfont=bf]{caption} % make label for figure bold

% Allow referencing into the supporting information, once that exists.
\IfFileExists{./competition-kernels-sm.tex}{%
  \usepackage{xr}%
  \externaldocument{competition-kernels-sm}}{}

% We will generate all images so they have a width \maxwidth. This means
% that they will get their normal width if they fit onto the page, but
% are scaled down if they would overflow the margins.
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}


\title{Competition kernels: shapes and consequences}
\author{Richard G. FitzJohn, Daniel S. Falster, Georges Kunstler and Mark Westoby}
\date{}
\affiliation{Department of Biological Sciences, Macquarie University,
  Sydney, Australia}
\runninghead{The shape of competition kernels}
\keywords{Competition, coexistence, kernels, resources}

\usepackage{color}

\input{common-defs}

\begin{document}

% Disable words breaking over lines for final submission:
% \raggedright
% \pagestyle{empty}

\mstitlepage
\parindent=1.5em
\addtolength{\parskip}{.3em}

\begin{abstract}
Abstract goes here\ldots
\end{abstract}

\section{Introduction}

% TODO: in one of the first three sentences: get across the "core
% question" of:
%
%   How do traits and resources (via competition) structure communities?
Ecological communities are structured by the nature of the
interactions within them.
% Wondering here if thisis a good place to cite Dolphs "Adaptive
% Radiations" book, as it gets close to some of this.
In particular competition for common resources structures niches by
excluding some species and allowing others to survive
\citep[e.g.][]{Gause-1934,Lack-1947,MacArthur-1967}.
% TODO: I have a paper *somewhere*, probably from Quarterly Review of
% Biology that asks (skeptically) the question of whether plants
% see/use fewer resources than animals do.
%
% NOTE: this is not great, but we need a solid link through to
% resources.
If species differentially consume different resources, or different
types of a given resource, this can create regions of trait space where
different species can stably coexist.
% GEORGES: I have the feeling that 'traits' are coming out of the blue here a little bit. Later on we explain the link between traits and resources but may be we need to explained it here already.
The idea of species arranged along niche axes (e.g., Figure
\ref{fig:competition-kernels}) is iconic within community ecology and
is almost universally present in textbooks from 1970s through to the
present \citep[e.g.,][]{Krebs-1972, Ricklefs-1973, Ricklefs-1999,
  Krebs-2013}.
%
However, this worldview is particularly challenging for plant
communities, where most species use the same few resources
\citep[e.g.,][]{Whittaker-1970, Grime-1979, Hubbell-2001,
  Westoby-2002}.

% TODO: @richfitz Feels like this is really about plants -  mention at top
% somewhere. If you want it to be more general we should expand reference
% list to include animal examples
%   - RGF: I think that the first one is definitely more animally than
%   plant, the second is mixed and the third is planty.  Perhaps
%   that's interesting in itself...
Currently, at least three perspectives are popular in investigating
the relationship between resources, species traits and coexistence:
% GEORGES: again traits may be unclear here.
i) Theoretical models based on explicit ``competition kernels'' and
simple Lotka-Volterra dynamics
\citep[e.g.][]{MacArthur-1967,Case-1982,Dieckmann-1999,Leimar-2013}.
%
ii) Models in which resources are modelled explicitly, and species
interactions emerge from competition for the resources
\citep[e.g.][]{Tilman-1977, Huston-1987, Kohyama-1993, Falster-2011}.
%
iii) Empirical, generally correlative, approaches that seek to
describe major axes of trait variation among species and relate that
to underlying differences in competition for resources
\citep[e.g.][]{Grime-1979, Weiher-1999, Westoby-2002}.
% GEORGES: I think that 'relate that
% to underlying differences in competition for resources' do not fully reflects
%  the stat of progress in this approach. May be we can explain that this is in
%  the hope of connecting traits to competition. 
% So far we no little about the link between traits and coexistence.
% NOTE: ignoring 4th approach for now, via ecological drift /
% neutrality, but it falls most closely into the 3rd approach.  Framed
% as above, in terms of "traits / resources / competition" neutral
% theory is not as relevant anyway.
Broadly these different literatures represent different ways of
addressing the same core question, rather than addressing fundamentally
different hypotheses.  Despite this similarity they have remained
largely isolated from one-another.
% GEORGES: WIth the current structure we are repeating this idea of a 
% lack of connection two times, but may be this is ok.

In the first strand, individuals from different species interact via a
``competition kernel'' --- a function describing how rates of
population growth of one species are reduced by the abundance of
another species with respect to resource preferences or traits of the
two species.
%
While initially competition kernels were derived via resource
utilisation curves, and expressed relative to a resource axis
\citep{MacArthur-1967, Roughgarden-1979}, there has been an almost
complete switch to expressing kernels based on difference in trait
values.
% GEORGES: I think that to clarify the differences between 
% strand 1 and 2 may be we need to explain that by using a continous 
% resources axis this is refering to theoretical ressources 
% unmeasurable in the field.
Competition kernel--based models have been usd to model dynamics of
character displacement \citep{Taper-1985, Case-2000}, species
coexistence and community assembly \citep{MacArthur-1967,
  Calcagno-2006, Leimar-2013}, and sympatric speciation
\citep{Dieckmann-1999}.
%
These models are amenable to analysis and it is possible to determine
the outcome of competition from subtle changes to the competition
kernel \citep{Calcagno-2006, Scheffer-2006, Pigolotti-2007,
  Leimar-2013}.
%
In practice, researchers have focussed on a limited number of kernel
shapes, in particular Gaussian, asymmetric Gaussian or logistic shapes
(Table \ref{tab:shapes})

Resource based models differ from the kernel-based approaches in that,
rather than being inferred from a trait-based kernel, competitive
interactions are moderated via a resource whose abundance is modelled
explicitly.  As such, the competitive effects ``emerge'' from the
model -- i.e. the shape of competitive function with respect to
species traits is not specified, rather it is an output of the model.
% GEORGES: From this sentence it is not totally clear how this differ 
% from strand 1 as also based on resources. May be we need to explain 
% that these model are based on competition for limited number of
% REAL resources?
In this paper, we will consider two classes of resource-based model.
%
The first is Tilman's ``\Rstar'' model \citep{Tilman-1977,
  Tilman-1982}, which focusses on the minimal level of resource
abundance that individuals from a species can tolerate.
% GEORGES COMMENT: I think that the distinction between model based on
% unmeasurable traits or not easly measurable traits such as the R*
% and model based on easily measurable traits that were developped in
% the strategies (iii) (Grime Weiher and Westobty) of the intro is importamt here.
% May be we should introduce only the R* here and introduce plant on the in the 
% next paragraph on traits as  a link?
%
% Direct species interactions are absent, and resources do not
% instantly replenish.  Trait link is low.
% I don't think this matters here?:
%
% Similar to the kernel-based models, populations are unstructured, so
% competitive interactions occur within a ``mean field''.
The second type are mechanistic niche models, which allow for 
differentiation in successional strategy via size-and
trait-driven interactions within size-structured communities or
meta-communities
\citep{Huston-1987,Kohyama-1993,Moorcroft-2001,Falster-2011}.
% Dropped:
% Although competition for below ground resources may also be
% considered, competitive occur largely via shading of smaller plants by
% taller plants within a patch.
% ----
% also models in which individuals compete for space. But these
% actually fall in with kernel based models - competition-colonisation
% models
% In both types of model, traits modify how species use the resource, but to the
% extent they exist,  any species-level competition-kernel arises only as emergent property
% of the entire system.
% Extra sentence - perhaps not needed
% Beyond the handling of competitive interactions, the dynamics of character evolution
% and species coexistence are modelled in largely the same way as in kernel-based models
% \citep[e.g.][]{Falster-2015}.

The empirical approach to investigating how species traits affect
coexistence attempts to classify species into different strategy
schemes
\citep{Grime-1974,Grime-1979,Southwood-1977,Weiher-1999,Westoby-2002}.
%
% For plants, prominent traits include morphological and physiological
% characteristics of individual tissues such as leaf mass per area
% (\textsc{lma}), and features affecting allocation, such as height at
% maturation (\textsc{hmat}) \citep{Westoby-2002}.
%
Existing strategy schemes lack explicit theory illustrating how
trait-based community might work \citep{Adler-2013}.
% TODO: this feels weak still:
% GEORGES: If we clarify in the section early on in the introduction
%  that the link between traits and coexistence is missing here may
% be we can explain that people have directly used normal competition 
% kernel to traits without any good justification?
However, characteristics such as trait over-dispersion are often
interpreted as
signatures of niche diversification \citep[e.g.][]{Kraft-2008} while
correlations amongst traits and growth rates may indicate
diversification in successional strategy \citep[e.g.][]{Wright-2010}.
% GEORGES: I think I see what you mean (coexistence of diff traits value 
% because different they are selected at different time during succession), 
% but this is not that that clear from the correlation with growth rate. 
% In addition Wright-2010 is quite far away from proving coexistence.
The connection between statistical signal and theory therefore depends
critically on the validity of insights drawn from
the two more theoretical approaches. 
% The connection with the theory is unclear, in addition I don't think a lot of studies have tried to test prediction in term of pattern of the successional 'niche of Wright-2010.

Ideally, these different approaches to studying community assembly
would mutually reinforce each other, yet to date the literatures
remain relatively isolated from one another.
% 
In this paper we try to bridge this divide, by asking whether the
signature of competitive interactions that emerges from resource-based
models resembles the trait-based kernels used in kernel-based
approaches.
%
To achieve this we determine the shape of the competition functions
that are produced in two different models where competition and the
mechanics of the resource being depleted are represented explicitly.
%
This approach is not entirely new; \citet{Abrams-2008} found the \Rstar\
model
to satisfy few of the assumptions that underpin Lotka-Volterra
dynamics.
%
We extend \citeauthor{Abrams-2008} approach by focussing on trait-based kernels and
by
including a second class of resource-based model involving
successional niche differentiation.
%
Specifically, we assess whether several assumptions embedded within
most kernel-based analyses are compatible with the behaviour of the
resource-based models by asking;
%
i) what is the shape of the competition function emerging from resource-based
models?
%
ii) does the shape of the competition function remain constant with
respect to the traits of species in the community?
%
iii) does the shape of the competition function remain constant with
respect to the density of the species in the community, as commonly
assumed in kernel-based models?

\section{A brief history of kernel-based approaches}

% As the above quote indicates, the dominance of a single model type
% within theoretical ecology was already of concern in 1974. In
% subsequent 40 years, the only substantial change has been the
% widespread adoption of trait-based competition kernels. Given the
% dominance of this approach within this branch, it may be helpful to
% review the history by which the which this dominance came about.

% TODO[RGF]: throughout, decide if we want competition kernel or
% competition function.  while a lot of the recent literature calls
% them kernels, that's not really appropriate for the generalised
% case.

% NOTE: trying the history bit way up here, see if that helps.
% GEORGES: I have the feeling this section is a bit long. 
% And overall several paragraph seems not strongly connected 
%to competition kernel (in contrast with the sub-section title).
The metaphor of species packing has long been central to community
ecology.  This idea supposes there is a volume of niche space, and
each potential community member has a ``fundamental niche'' within
that volume.  The fundamental niche is compressed by competition into
a realised niche, as species are packed in alongside each other
(Figure \ref{fig:competition-kernels} for one-dimensional version
found in many textbooks).
%
The roots of the species packing metaphor trace to the competitive
exclusion principle \citep{Lotka-1925, Volterra-1926, Gause-1934}
whereby if species have identical niches or compete for the same resource
units, all but one are competitively excluded.
\citet{Hutchinson-1957} generalised this concept to consider multiple
resources, creating an $n$-dimensional hyper-volume for the fundamental
niche.
% GEORGES: DO wee need to discuss Hutchinson here?
The competitive exclusion principle was thereby converted into the
question how dissimilar two species need to be in order to coexist
\citep{MacArthur-1967, Slatkin-1980}.
%
By the 1970s, a new generation of textbooks built their account of
community ecology around three alternative ways of getting more
species into a community: larger total niche space, more overlap
between adjacent niches, or narrower niches for each species
\citep{Whittaker-1970,Krebs-1972,Ricklefs-1973,Pianka-1974}. The
species packing metaphor has persisted up to the present day as the
mainstream approach to community ecology.
% GEORGES: The idea whether this is a larger niche space, or more overlap
%  are not so strongly connected to competition kernel, no?

In 1960s theory and 1970s textbooks, niches were typically thought of
as utilization functions along a continuous resource axis. The
resource in question would be depletable or pre-emptable, in order for
overlap of utilization functions to translate into
competition. Pairwise competition coefficients (such as the
$\alpha_{ij}$ parameters in Lotka-Volterra competition) could be
calculated from the degree overlap between utilizations functions.
If a trait was used as a niche index, it was chosen on grounds of
mapping tidily on to a depletable resource, such as beak size for
seed-eating finches. 
% I think this link between traits and resources need to be introduced before in the intro.
Beginning in the 1980s, a desire to model
character displacement saw the concept of a utilisation function first
approximated via a trait -- the mean size of utilisation function
\citep {Roughgarden-1979} -- and second replaced entirely by a kernel
defined by traits \citep{Slatkin-1980,Taper-1985}. This shift enabled
and flowed into models for character displacement
\citep[e.g.,][]{Taper-1985, Case-2000, Goldberg-2006} and trait
evolution \citep{Brown-1987,Geritz-1998,Geritz-1999,Dieckmann-1999,
  Abrams-2001}.

% TODO[RGF]: Not sure about this bit yet; there are no references here
% and it's not totally clear what it means.  The bit about shapes
% comes from nowhere and doesn't really add much to the bit above
% (search on tab:shapes).  Plus it's wrong; we know from the Fourier
% transform that one can jump straight from kernel to assembly.
% That's pretty cool.
Trait-based competition kernels are best thought of within the
adaptive- dynamics tradition of fitness landscapes [e.g.][]\citep
{Geritz-1999}. Species exist,
coexist and evolve on a landscape where the axes are evolvable
traits. A competition kernel represents the impact of a species on
this landscape --
% NOTE: we actually have the opposite kernel here; that would be
% \alpha(x_I, x_R) but we compute \alpha(x_R, x_I).
the drawdown of fitness across the landscape as it
relates to the trait-values both of the species exerting a competitive
effect and of the species experiencing the effect.
% NOTE: we have nice pictures of that here:
% https://github.com/traitecoevo/plant_paper/wiki/fitness wich would
% be nice to link in perhaps.  Depending on how the publication goes
% perhaps we can link to it...
% GEORGES: Not sure we need this section adaptive-dynamics.
As such, the shape of the kernel is central to the question how
species interact within the models using them.
% TODO[RGF]:
By far the most common type of competition kernel in textbooks and in
theoretical literature is that they are unimodal (Gaussian),
decreasing with trait-distance away from the species that is exerting
the competitive effect. Other shapes have been considered, but for the
most part these are variants on two forms: Gaussian and logistic
(Table \ref{tab:shapes}).
% TODO[RGF]: yeah, so this is wrong.
Recent work has shown that the subtle details about the exact shape of the
kernel can substantially alter the possibilities for coexistence
\citep{Calcagno-2006, Scheffer-2006, Pigolotti-2007,
 Barabas-2012,Barabas-2013,DAndrea-2013,Leimar-2013}.

% TODO[RGF]: The first half of this paragraph (up to "While
% expressed") seems pretty redundant. -> DF: Added extra sentence at beginning
% to make relevance clearer.
Assumptions about the nature of competition also feature in two other 
related strands of thinking that persist to current day were established. In
a break from the idea of subdividing continuous
niche axes, models arose
that visualised communities as a chessboard of living sites, each able to be
occupied by one sessile individual \citep{Yodzis-1978}. Coexistence could
arise by colonization-competition trade-offs \citep{Levins-1971,
Geritz-1999, Calcagno-2006}; which required that competitive interactions
be strongly size-asymmetric. Alternatively, if there is an advantage to
already established individuals (another form of competitive asymmetry),
chance successes in the colonisation of vacant sites  -- arising from 
demographic stochasticity
(``lottery effects'') \citep {Sale-1977, Hubbell-2001} -- can slow
competitive exclusion and thereby promote coexistence. 
%
Note that all models also make strong assumptions about the shape of
the competition kernel being used -- a sharp
logistic kernel in competition colonisation models and a
flat, trait-independent kernel in neutral lottery models.

% TODO[RGF]: I don't really see the difference here with the limiting
% similarity/species packing arguments.  This is very much what
% MacArthur and Levins are on about.]
The other strand of thinking, already established during the 1970s in
parallel with the species packing metaphor, was theory showing that
with Gaussian kernels along a single niche axis, there is in fact no
limit to similarity \citep{May-1972, Abrams-1975,
  Abrams-1983}. Competitive exclusion can become slow because two
competitors are similar in their resource use as well as because they
are different. ``Continuous coexistence'' is a theoretically possible
outcome, with resources occupied by many species spaced from each
other in resource use by arbitrarily small amounts.
% NOTE[RGF]: this seems entirely compatible with species packing to me
% as a limit case?  Perhaps I'm missing somsething.
% GEORGES: 1. I'm not sure this 'Continous coexistence' is a classical 
% expression, 2. @Rich I think the main difference is that the limiting 
% similarity tend to zero (so yes a limit case but in term of community
% structure the prediction are quite drastically different).
Although this strand of theory might have been expected to undermine
the mainstream approach to community ecology via the species packing
metaphor, in actuality it did not have the effect of dislodging
species packing from standard textbooks, probably because it did not
really offer an alternative program for connecting theory to field
measurement.  After 2000, this line of theory began to explore more
systematically the consequences of possible kernel-shapes for
community assembly \citep{Scheffer-2006, Barabas-2013, Leimar-2013}.
% GEORGES: overall i have the feeling that this section going beyond 
% competition kernel, as it is discussiong the community level 
% consequence of a given competition kernel. The important point for us
%  is may be simply that small deviation in the competition kernel shape
% may have strong effect on the community structure? 
It is clear that the shape of competition kernels 
could be key to
understanding community assembly. Yet, it is also likely that
symmetric unimodal kernels that are most widely used are realistic for only
a minority of
real-world communities. The menagerie of possible
competition
kernels has only begun to be catalogued (Table \ref{tab:shapes}); much
less have the implications of different kernels for community
assembly been worked through
\citep{Barabas-2012,Barabas-2013,DAndrea-2013,Leimar-2013}.  The
literature up to the present has mainly been focused on Gaussian and
logistic kernels, probably because of mathematical tractability.
Surprisingly little attention has been paid to the question what
shapes are actually likely for competition kernels, given known
mechanisms for resource depletion in relation to traits, and the
parallel focus on resource based models such as \Rstar.
% GEORGES: 'the parallel focus on resource based models such as \Rstar.' 
% is unclear for me.

\section{Models}

In general, we would like to know what the shape of competition
functions look like in natural systems.  However, holding all else
constant and isolating the effect of one species on the population
growth rate of another is intractable.
% GEORGES: may be this is possible for batceria or annual plants or
% this kind of system, but in general this is a hughe task.
An alternative approach is to analyse models where the competitive
effects emerge from lower-level interactions
\citep[e.g.,][]{Draghi-2012}.  Mechanistic models make more direct
% TODO: @richfitz which phenomenological models did you mean?
%  - RGF: Ah, I meant the LV type models.  I guess that's not clear then.
% GEORGES: 'the simple models' which models???
connections to the natural world than the simple models,
while still remaining tractable.  This does not require or assume that
the mechanistic models are correct or complete descriptions of the
natural world.

% NOTE: Thoughout, decide how to use the terms ``competition kernel''
% and ``competition function''; in the usual use they are roughly
% equivalent but here they are probably not: see
% http://math.stackexchange.com/questions/22133/difference-between-kernel-and-function
% That post doesn't really clarify much, in part because there are multiple definitions
% of kernel http://en.wikipedia.org/wiki/Kernel
% This one seems most useful: http://en.wikipedia.org/wiki/Equaliser_(mathematics)

% In the first paragraph, I guess we describe the entire approach as
% well as possible.

% NOTE: This is hard to introduce properly because the Abrams kernels
% need dealing with explicitly.  But of course we don't really use
% them (yet -- see issue #35), and note that not all are even possible
% (some require that coexistance is possible).
We investigate the dynamics of two quite different models --- \plant\
and \Rstar\ --- where the competitive impact of one species on another
arises via the effect of individuals on a shared resource.
%
In each model, species traits influence the dynamics of resource use,
which in turn affects competitive interactions through the common
resource.  Several ways of computing competition coefficients are
possible \citep[e.g.,][]{Abrams-1987,Abrams-2008}.  When the
underlying dynamics follow the Lotka-Volterra equations, then the
different coefficients will be the same.  We use another formulation
based on simply solving for the competition coefficient in the
Lotka-Volterra equation.
% GEORGES: Not clear that the second sentence is for the case where the 
% model do not follow the LV model.

For each model, we compute the core quantities used in the
Lotka-Volterra equations (growth rate, carrying capacity, per-capita
rate of population increase and strength of competition).  The
standard Lotka-Volterra equations express the rate of increase in the
abundance of species $i$ as a product of three terms.
%
The first is the abundance of species $i$, $N_i$.
%
The second is the maximum possible per-capita growth rate, $r_i$. The
third expresses the degree to which that maximum is realised, and
thus includes any reductions due to competition with other species. A
commonly used form for Lotka-Volterra dynamics is
%
\begin{equation}
\label{eq:LV}
\frac{\ud N_i}{\ud t} =
N_i r_i \left(1 - \sum_j \frac{\alpha_{ij} N_j}{K_i}\right),
\end{equation}
%
where $K_i$ is the equilibrium value for $N_i$ when species-$i$ is
grown in a monoculture (i.e., the carrying capacity), and
$\alpha_{ij}$ is the per-capita competitive effect of species-$j$ on
species-$i$.  By convention, competition functions are expressed as
the effect of species-$j$ on species-$i$, relative to the effect of
species-$i$ on itself. Thus $\alpha_{ii}\equiv 1$, while $\alpha_{ij}
>
1$ implies stronger interspecific competition than intraspecific
competition.
% TODO: note that alpha of 1 is relative to intraspecific competition
% *at equilibrium* and this is how we detect departures from constant
% density dependence.
The sum is over all species in the population, with
competitive effects assumed to be additive across species and density
independent within a species.
%
Other forms of equation (\ref{eq:LV}) exist that differ in the nature
of density dependence \citep[e.g.][]{Leimar-2013}, but for simplicity
we consider a single version.

We are interested in situations where the different parameters in
equation (\ref{eq:LV}) are functions of traits; that is replacing the
subscripts in the above equations as continuous functions of species
traits $x$.  In particular the coefficient $\alpha_{ij}$ becomes a
function $\alpha(x_i, x_j)$.
%
We restrict our analysis to the simplest situation where a single
type with trait $x_I$ invades a community comprising a single
resident type with trait $x_R$ at equilibrium.  The fitness $f_I(x_I,
x_R)$ of the invading type is its per capita rate of increase when
rare ($N_I = 0$), or:
%
\begin{equation}
  \label{eq:LVi}
   f_I(x_I, x_R) = \frac{\ud N_i}{\ud t} \frac{1}{N_i} =
    r(x_I)\left(1 - \alpha(x_R, x_I) \frac{K(x_R)}{K(x_I)}\right).
\end{equation}
% TODO: Move this into the discussion, I think.  This is the
% "classical" criticism of LV as a useful device for doing anything in
% natural systems.
%
%   The reason for this narrowing of focus is that it is not possible to
%   infer the shapes of competition functions in situations with more
%   than one resident, because the number of unknowns increases faster
%   than the number of species (refs?).

To estimate the shapes of competition functions embedded within the
\Rstar\ and \plant\ models, we use those models to calculate all of
the trait-dependent terms in eq. \ref{eq:LVi} except $\alpha(x_R,
x_I)$:
\begin{enumerate}
\item $f_I(x_I, x_R)$: fitness of rare invader with traits $x_I$  in
  competition with a established resident with traits $x_R$
\item $r(x_I)$: maximum possible fitness of invader, i.e. fitness in
  the empty environment.
\item $K(x_I)$: equilibrium population density of invader when growing
  in monoculture.
\item $K(x_R)$: equilibrium population density of resident when
  growing in monoculture.
\end{enumerate}
We then solved for $\alpha(x_R, x_I)$ by rearranging  \ref{eq:LVi} to give:
\begin{equation}
  \label{eq:alpha}
  \alpha(x_R, x_I) = \frac{K(x_I)}{N_R}
  \left(1 - \frac{f_I(x_I, x_R)}{r(x_I)}\right)
\end{equation}
(note that at equilibrium $N_R = K(x_R)$).

In addition, we also calculate one of the coefficients described in
\citet{Abrams-2008}: $\chi_{ij}^{*}$:
%
\begin{equation}
  \label{eq:abrams-coef}
  \chi_{IR}^{*} =
  \frac{\partial f_I(x_I, x_R, N_I, N_R) /  \partial N_R}%
  {\partial f_I(x_I, x_R, N_I, N_R) / \partial N_I}
  \bigg|_{N_I=0; N_R=K_{R}}
\end{equation}
%
where the numerator is the derivative of invasion fitness with respect
to resident density, the denominator is the derivative of invasion
fitness with respect to invader density, and this is evaluated at the
situation where the resident is at equilibrium and the invader is at
trivial density.  This index therefore measures the extent to which
the resident depresses the growth of an invader relative to the amount
that the invader depresses its own growth.

\subsection{\Rstar\ model}

% \item As originally formulated, \Rstar\ does not include traits
% \item We adapt a formulation (due to whom?) where a ``trait'' is a
%   measure of specialisation/generalisation.

In the first model (\Rstar) individuals compete for two essential and
depletable resources. This model is one of the best studied and cited
models of resource competition \citep{Tilman-1977, Tilman-1982,
  Huisman-2001}, originating from a study on exploitative competition
for any pair of generic resources \citep{Leon-1975}. The model is
unstructured, with the per capita growth rates for each species simply
depending on the availability of two resources.  We assume both
resources are necessary (i.e. non-substitutable), so the growth rate
of each species is determined by the resource which is currently most
limiting.  We implemented a version where the specific growth rates
follow a Monod equation as in \citet{Huisman-2001}, which is closely
similar to the widely-used version described by \citet{Tilman-1977,
  Tilman-1982}. 
% GEORGES: What is the difference with Tilman 1977?
 The resource availabilities, in turn, depend on the
rates of resource supply and consumption. Individuals compete with one
another by drawing down the joint resource pools. Such a system is
easily described via a minimal set of equations (Appendix
\ref{sec:Rstar}).

Following previous authors \citep{Tilman-1985, Schreiber-2003,
  Fox-2008} we focus on a trait determining the relative amount of the
two resources required for growth. Species can vary from requiring
mostly resource 1, to equals amounts of both resources, to mostly
resource 2. This dependence is achieved by making uptake saturation
constants (see Appendix \ref{sec:Rstar} for details) for resource 1
inversely related to the requirement of resource 2:
\begin{equation}
\label{eq:R3}
U_{1i} = 1 - U_{2i}.
\end{equation}
(Note that the $U$'s here are $K$'s in \citet{Huisman-2001}, but we
use $U$ to avoid confusion with carrying capacity.)
%
% TODO: @richfitz Below we refer to big C, is that the same as $c_{ki}$?
% If so we allow it to vary among species, i.e. not constant as implied ins
% sentences below.
%   - RGF: Fixed to big C.  It's fixed at the moment, but see #42 for
%   more on this.
The rate of consumption of resource $j$ by species $i$ is determined by
$C_{ki}$ the content of resource $k$ in species $i$. We assumed that
the content was similar across species.

% GEORGES COMMENT IF WE KEEP USING THIS FORMULATION WE NEED TO EXPLAIN
% C HERE OTHERWISE IT SHOW UP IN THE RESULTS WITHOUT ANY
% DEFINITION. IF WE ASSUME C=U THIS MAY HELP TO SIMPLIFY THIS SECTION?
%
% Yes - I (RGF) agree - just need to port the model over to use the
% formulation that you prefer.

\subsection{\plant\ model}

The second model, \plant, is a mechanistic model of plant competition
for light in a size-structured metapopulation \citep{Falster-2011,
  Falster-2015}. \plant\ is used here as an example of a broader group
of models dealing with successional turnover
\citep{Huston-1987,Kohyama-1993,Moorcroft-2001,Falster-2011}.
% GEORGES: I think presenting 'plant' as similar to this model is 
% hiding an originality which is that the model is dealing with real traits!

Vegetation in the \plant\ model comprises a large number of patches subject
to a prevailing disturbance regime.  Disturbances remove established
vegetation within a patch, which is then recolonised via seed
dispersal from other patches.  Individual plants progress through
their life-cycle, from seeds until mature adults, with growth survival
and fecundity rates determined by the combined effect of an
individual's traits, its current size and the degree of shading from
other plants within the same patch. The amount of shading at a given
height is computed from the cumulative leaf area above that height;
short-term competitive effects are therefore size-asymmetric. The sole
effect of shading is to alter an individual's photosynthetic
income. Following \citep{Falster-2015}, the fitness of individuals
with a given type is calculated by integrating seed output across the
entire metapopulation.

We use the \plant\ model to estimate trait-based competitive functions
for two traits whose evolutionary dynamics have recently been
investigated \citep{Falster-2015}: leaf mass per area (\textsc{lma})
and height at maturation (\hmat). In the model, \textsc{lma} moderates
a physiological trade-off between the cost of building an extra unit
of leaf area and the rate of leaf turnover.  Variation in \textsc{lma}
thereby underpins a trade-off between height growth rate and
shade-tolerance of seedlings, and is a key comonent of the so-called
``leaf economics spectrum'' \citep{Wright-2004}. Meanwhile, \hmat\
moderates the allocation of surplus energy between growth and seed
production, as an individual increases in size.

% TODO: Something about how hmat leads to a fundamentally asymmetric
% competition situation? -- i.e., talk about the *expectations* for
% the different models.

\section{Results}

% For each model there are a few things to discuss:
%
% - Non-equilibrium before equilibrium
% - Density dependence after discussing each model
% - Different measures of competition (where?)

\subsection{\Rstar}

For the \Rstar\ model we consider two cases: a ``symmetric
consumption'' case with $C = \{0.2, 0.2\}$ and an ``asymmetric case''
with $C = \{0.3, 0.7\}$.  Species vary only in their rate of resource
conversion efficiency and the degree in which they specialise in the
two resources.  For each case, we consider two resident communities;
one in a position where invasion by other types is possible and one at
the evolutionary optimum point.
%
Because $C$ does not vary by species, coexistence is not possible in
this model \citep{Tilman-1982}; invasion is thus a sufficient condition for
competitive replacement.

In the symmetric model, we first consider a resident at $x = 0.6$
(midway between pure generalist and pure specialist on resource B).
%
The resident species competes strongly with species that are more
specialised than itself (self competition is $\alpha(x, x) \equiv
1$), while invaders that were less specialised (i.e., closer to $x =
0.5$ than the resident) experienced less competition from the resident
than it exerted on itself (Figure \ref{fig:Rstar}b).
%
The region of competition $< 1$ lines up perfectly with the region
where invasion is possible (black bar on Figure \ref{fig:Rstar}b,
fitness greater than zero on Figure
\ref{fig:sm_rstar_components1}c1).
%
When the resident is moved to $x = 0.5$ (perfectly generalist) then
invasion is not possible for any type.  In this case, the strength of
competition increases monotonically away from the resident.
%
Computing competition functions using the derivative approach
described in \citet{Abrams-2008}
($(\partial d_i / \partial N_j) / (\partial d_i / \partial N_i) |_{N_i
  = 0, N_j = K_j}$)
was qualitatively similar, though piecewise linear in species traits
and with higher departure from 1. 
Either way, the shape of the kernels produced looks nothing like any of the
common shapes depicted in Table \ref{tab:shapes}

In the asymmetric case, consumption rates are higher for
resource $B$ than resource $A$; this shifts the model in favour of
species that can most efficiently use resource $B$.
%
With a single resident at $x = 0.7$, invasion is possible for species
that use $B$ more efficiently ($x$ in $(0.7, \approx 0.99)$).
%
The shape of the competition function was considerably more
complicated than the symmetric case, though the region of invasion
still corresponded to the region where competition was less than 1.

In both the symmetric and asymmetric case, competition was density
dependent.  Increasing the resident density changes the per-capita
competitive impact.
%
In the symmetric model, the \emph{shape} did not qualitatively change,
and competition was always saturating with increasing density.
Increasing species density decreased the per-capita competitive effect
(Figure \ref{fig:rstar_density_dependence}a--b).
%
In the asymmetric model, the shape of competition qualitatively
changed, though on average per-capita competition appeared to decrease
with increasing density (Figure
\ref{fig:rstar_density_dependence}c--d).

\subsection{\plant: \hmat}

In the \plant\ model, strategies that have different height of
maturation (\hmat) begin to focus resources on reproduction at
different sizes.  Plants that reproduce earlier get to ``lock in''
reproduction, but because they allocate less resources to growth they
risk being over-topped and out-shaded by strategies that reproduce
later.  This leads to a strongly asymmetric competitive effect of
taller strategies suppressing the population growth of shorter
strategies.

We recover competition functions that are asymmetric in this case:
strategies exert more competition on species that are shorter than
them than are taller than them (Figure \ref{fig:plant_hmat}).  As the
resident strategy increases in size, the strength of competition felt
by smaller species increases, and the slope of this competitive effect
increases (compare panels \textit{a} and \textit{b} in Figure
\ref{fig:plant_hmat}.
%
Despite the consistent direction of competition, invasion depends on
the interaction between competitive effect, carrying capacity and
maximum growth rate; in the presence of a short resident, taller
strategies can invade (Figure \ref{fig:sm_plant_hmat_components}\,c1),
while in the presence of a tall resident, shorter strategies can
invade (Figure \ref{fig:sm_plant_hmat_components}\,c2).

This property is very similar to other models of asymmetric
competition \citep[e.g.,][]{Kisdi-1999}, where selection pushes traits
to an ``branching point'' (close to the resident in (Figure
\ref{fig:sm_plant_hmat_components}c2), and then repeated invasion to
the left of this point is possible.
% TODO: SM figure showing the equilibrium community for each of the
% scenarios presented (#31).
Even though the shape of the function is not exactly sigmoidal, the
evolutionary dynamics are similar (\TODO).
% TODO: Run out the evolutionary dynamics of plant/hmat and Kisdi to
% show that things do actually look similar with continual reinvasion
% of mutants to the left.
% TODO: density dependence
% TODO: Abrams kernel calculation

\subsection{\plant: lma}
Strategies that have different leaf mass per unit area (\textsc{lma})
values are different points in the ``leaf economic spectrum''
\citep{Reich-1997,Wright-2004}.  We modelled \textsc{lma} as a trade-off
between the cost of deploying an extra unit
of leaf area and the rate of leaf turnover (so high \textsc{lma} leaves are
costly to deploy but turn over more slowly so that they can contribute
to carbon gain for longer, or conversely require rebuilding less
often).

The shape of the competition function is complex and does not conform
to any of the simple shapes in wide use, as depicted in Table \ref{tab:shapes}.
% Need to be clear that we're talking about the non attractor
% situation first.
In the region of trait space close to the resident species,
competition is strongly asymmetric: the resident exerts a large amount
of competition on species with \textsc{lma} values higher than itself (``slow''
strategy species) and less on species that have \textsc{lma} values lower
(``fast'' strategy species; Figure \ref{fig:plant_lma}a).  Invasion is
possible in the region with \textsc{lma} values smaller than the invader until
growth and carrying capacity reach a biological limit to invasion
(Figure \ref{fig:sm_plant_lma_components}c1).
%
Above the resident \textsc{lma} value, the competition function is sawtooth
shaped, before eventually declining steeply.
%
In contrast to the complex shape of fitness and competition, maximum
growth rate has a simple form and carrying capacity is approximately
Gaussian (Figure \ref{fig:sm_plant_lma_components}\,a and b).

Moving the resident towards the evolutionary attractor, invasion is
possible through a broad range of trait values (both above and below
the resident value).
\begin{itemize}
\item Make the case that the sawtoothness \textbf{probably} corresponds to
  differences in how time is partitioned (\TODO).

\item Explain how is it the case that invasion is possible through the
  region where competition $\approx 1$ -- that doesn't make much sense!
  It's similar to the situation with \hmat\ though (\TODO).
\end{itemize}

\section{Discussion}

\emph{``The nearly complete dependence of theoretical community ecology on a
limited number of simple models has resulted in the development of subsequent
generations of deceptively simple constructs that may often confuse our
understanding of the underlying biology rather than improve it. The
Lotka-Volterra competition equations and the community matrix are one such
pair of constructs.''} \citep{Neill-1974}

We inferred the shape of trait-based competition functions that emerge
from two resource-based models of competition, focussing on the
special case of a rare species invading a monotypic community.
%
In the models we investigated, the competition functions: i) were
density dependent, implying non-linear per-capita competitive effects
\citep{Abrams-1980}; ii) varied qualitatively and quantitatively with
resident phenotype,
% TODO[RGF]: I need to get clarification on this point
implying that they are not actually kernels but functions,
%
and iii) had shapes that were distinctly non-Gaussian, suggesting
limited connection with the wide array of theoretical models assuming
Gaussian shapes.
%
Trivially, our results demonstrate that the \Rstar\ and \plant\ models
are not well approximated by a Lotka-Volterra system, at least for two
of the three traits we investigated. That the Lotka-Volterra--based
models do not perfectly approximate the resource--based models in
itself is not surprising.
%
More substantially, the departure in the derived competition functions
from the Gaussian kernels assumed by most theoretical investigations
is so drastic that it is difficult to reconcile the two approaches.
Both approaches purport to give insights into the mechanisms of
community assembly via competition for resources.  Yet, there seems no
straightforward way of interpreting the results from the
resource-based models, for two of the three traits investigated,
within the known behaviour of Lotka-Volterra systems, or through
recent generalisations \citep{Leimar-2013}. This perhaps suggests that
we have been focussing our theoretical investigations on an
unnecessarily restricted region of possible model space.

\subsection{Competition functions in resource-based models look nothing like
fixed Gaussian kernels}

% GEORGES: It is clear for me that the main message for the discussion is that models based on real competition for resources do not lead to gaussian like competition kernel and do not respect the asssumption of the LV model (denssity dependent) so we need based our understanding of plant communities on LV model with gaussian kernel. But thne I have the feeling is in unclear if the nex step is to say that we need to develop more complex model connecting traits and competition for resources forgetting about the concept of competition kernel in LV model or if it is still usefull to use this framework. 

In only one of the three cases studied here did our derived
competition functions closely resemble any of the three dominant
curves used in most theoretical investigations. The common forms are
the Gaussian, asymmetric (offset) Gaussian \citep{Roughgarden-1979}
and logistic \citep[e.g.][]{Kisdi-1999, Law-1997}.  The derived
function from the height at maturation (\hmat) within \plant\ looks
qualitatively like the logistic kernels used in models investigating
asymmetric competition \citep{Law-1997, Geritz-1999, Kisdi-1999,
  Calcagno-2006}.
% GEORGES: What is qualitatively like a logistic monotonic?
 The competition function for our \textsc{lma} model
at least superficially resembles the asymmetric Gaussian, but the
ridges along the top are distinctly non-Gaussian and arise from real
biological features of the system.
%
\citet{Falster-2011} showed how the amount of shading undulates
through successional time; here this translates into undulations in
the fitness of an invader with respect to traits. 
% TODo @richfitz: next line commented out. Important, but this feels 
% like the wrong place.
%; despite appearing to compete for light
% the important resource axis may be \emph{time}.
%
It is hard to generalise about these findings; all we can say is that
none of the functions resemble Gaussian kernels.

We also found that, for all three of the models, the derived
competition functions were strongly density dependent. It was not only
the amplitude of the function that changed, but also its \emph{shape}
(Fig. \ref{fig:dd} and \ref{fig:rstar_density_dependence}).
%
This result was predicted by \citet{Abrams-1980}, who argued that not
satisfying the implicit of Lotka-Volterra dynamics would lead to
widespread non-constant density dependence. The idea that competitive
effects are non-linear in density (i.e. non additive) is widely
established within other more empirical realms of plant ecology, e.g.
in the self thinning law \citep{Westoby-1984}, and the law of constant
final yield \citep{Weiner-2010}.
% TODO[RGF]: When do we observe this?  I think all we get is the
% saturating pattern, no?
In both cases, the dynamics are similar to those we observe: initially
effects in either biomass or competition increase with population
density (as would be expected with a constant per capita effect), but
then once a saturating population density has been reached, addition
of more seed has little impact on the community. As such, the
per-capita effects change sharply with density. Similar findings exist
for animals: already by 1980 there were multiple reports showing that
competition coefficients were not independent of population density
\citep{Abrams-1980}.

Together, these findings imply the deeply ingrained assumption that
competition kernels can be defined by differences in trait values
alone -- without reference to population size, or absolute value of
traits -- seems inadequate for resource-based competition in plant
communities.
% GEORGES: May be the first point is that competition kenrel are 
% unlikely to be simple gaussian kernel!
Similarly, the notion that a fixed competition coefficient exists as a
property between two species is unlikely. This raises the question of
whether we should be seeking to revise our ideas about competition
kernels, or more generally about the usage Lotka-Volterra equations as
a foundation for modelling biological phenomena.  Indeed, many authors
have repeatedly raised similar questions \citep[e.g.][]{Andrewartha-1953,
  Neill-1974, Abrams-1975, Wangersky-1978,Abrams-1980, Tilman-1987,
  Abrams-2008}.

It is certainly possible to expand the idea of a competition kernel to
be a function not only of trait differences, but also of population
density and species traits. The consequence of including functions of
this type in traditional analyses about species-coexistence and
character displacement are simply unknown.  Even just allowing density
dependent competition could change the number of equilibria in the
model and the stability of such equilibria.
%
However, such an approach would only work if the competition functions
derived from pairs of species could still be added to get the effect
of an entire resident community on a potential invader.
% TODO: Note that we don't ever measure additivity, though we could
% actually.  But at the same time additivity is related to density
% dependence and I'd suggest density independence is required for
% additivity to hold.
Our results suggest that such additivity is unlikely
(Fig. \ref{fig:dd}). So in that case the competition kernel would be a
function of the entire resident community.  At that point we are
perhaps stretching he concept beyond its useful limit. We may as well
just use a model with explicit handling of resources.

\subsection{Enhancing the scope of resource-based models}

\emph{``The analysis of the Lotka-Volterra model developed here can only
suggest that, if there are limits to similarity in natural systems, these
limits will depend sensitively on the form of the competition coefficient,
which must be derived from another model.''}\citep{Abrams-1975}

Terrestrial plant ecology had always found it difficult to accept the
idea that different species can only coexist by using different
resources, as plant species clearly all require the same resources -- of
light, soil water and mineral nutrients -- as each other. One possibility
arises from species subdividing a successional-time niche axis in
landscapes envisaged as disturbance mosaics \citep{Connell-1978}. If
plant species make most contribution to their population increase in
different years following disturbance, then they certainly are
depleting different light and water from each other, and quite
possibly different soil nutrients \citep{Moorcroft-2001}. Another
possibility might arise via differentiation in soil depth or by accessing
alternative chemical forms of nutrients \citep{Tilman-1977}.

% TODO: I'm confused about the flow here:
One of the primary reasons we used models to study the nature of
competition functions was due the difficulty of estimating these in
the field.
% TODO: move a mention of this up further!
Thinking of empirical data, \citet{Ricklefs-1973} suggested one might use
the exact method we have
applied to estimating competition functions here, i.e. by measuring the
different elements of eq. \ref{eq:LVi} then using these to estimate
the competitive interaction (Fig. \ref{fig:components}).
% TODO: can we do better than these refs, and this sentence?
And indeed some estimates have been made \citep{Ricklefs-1973,
  Kraft-2015}.
%
However, nearly all manipulative measures of competition in the field
are going to give \emph{discrete} estimates of $\alpha_{ij}$: the
amount of competition exerted by or felt by a single species in the
context of another species or a community. As the number of species
increases, the number of pairwise competition coefficients needed
increases quadratically with the number of species. This is one reason
for seeking to define competition kernels on the basis of trait
differences, so as to reduce the number of parameters needed
\citep{Kraft-2015}. Estimating the shapes of trait-based competition
kernels requires that lots of pairwise comparisons to made, but as
species differ in many traits that will affect competition, combined
with the need to estimate fitness across the life- cycle makes the
task nigh impossible. In summary, it is simply not feasible to measure the
shape of a trait-based competition kernel in the wild. 
Models are attractive because they allow us to
run experiments in ways that are simply not possible in real systems.

The nature of the competition functions generated by the
resource-based models studied here raise an exciting possibility: we
could substantially expand the range of competition functions
currently being considered (Table \ref{tab:shapes}) and thereby expand
possibilities for coexistence. Functions like the \textsc {lma} kernel
(Fig. \ref{fig:plant_lma}) may look ridiculous compared with functions
typically used, yet they arise naturally from size-structured
dynamics.  It is likely kernels of this shape permit coexistence
through quite different dynamics than those well studied
\citep[e.g.][]{Leimar-2013}, rendering coexistence easier (or harder)
than we might otherwise suppose.

Similarly, it seems productive to further investigate the nature of
competitive interactions as it relates to traits, but with increased
emphasis on the nature of resource that is being contested. In the
case of traits such as \textsc{lma} and wood density, differentiation
corresponds to a subdividing of successional time. There is also
valuable insight to gained in applying the idea of trait-based kernels
to process occurring over shorter time-frames, i.e. in growth or
survival process rather than lifetime fitness
\citep[e.g.][]{Kunstler-2012, Lasky-2015}.  The findings of such
analyses test more directly the assumptions entering into
resource-based models and thereby allow for tighter integration of
theory with the sort of traits and species data that we have for plant
communities.

\subsection{Future directions \& conclusions, where next with models of
competition}

Despite being difficult to quantify in the field and represent in
models, competition is undoubtedly a powerful force in structuring
communities.
% TODO[RGF]: this is hard to parse
Even in neutral theory makes a
strong assumption regarding competition --- that total abundance in
the community is fixed \citep{Hubbell-2001}.
%
Our results reinforce previous arguments that if competition is
density dependent, non-additive across species, or if the shape of
competition varies with species traits and not just distance, then the
Lotka-Volterra equation will be not adequately capture the dynamics of
real systems \citep{Andrewartha-1953, Neill-1974, Abrams-1975,
  Wangersky-1978,Abrams-1980, Tilman-1987}.  It's difficult see what a
new set of equations might look like.  However, as a first step we
might more vigorously focus on models where resources are handled
explicitly.  We also note that in contrast with the close attention
paid to Lotka-Volterra based dynamics with explicit competition,
relatively few models exist where competition emerges from the
lower-level species interactions and that this is a potentially
untapped source of insight into the nature of competition.

Simultaneously, we should be looking to derive macroscopic
approximations of the more detailed resource-based models.  While we
might appear rather disparaging of simple models, this is not meant
to be a criticism of simple models \textit{per se}; simple models are
highly desirable.  However, we argue that focus should be on simple models
that were derived to approximate the behaviour of more complex models and
empirical findings \citep[e.g.][]{Champagnat-2006}.
% History of deriving higher-level approximations to detailed models.
The problem with the Lotka-Volterra system of equations is that the
model was formulated in isolation from the problem's to which it is
now being applied; the model is analysed because it is what
theoretical ecologists analyse, not because it is reflective of
ecology.

\clearpage

\section{Tables}


\begin{table}[h]
 \caption{Predominant kernel shapes used to date.
`Kinked'' kernels that are ``non-differentiable at the point of
self-competition'' \citep{Barabas-2012}.}
\centering
{\footnotesize
  \begin{tabular}{p{3cm}p{4cm}p{3cm}p{4cm}}
  \hline
  Name & Shape & Characteristic equation & References \\
  \hline
  \multicolumn{4}{l}{\textbf{Continuous}} \\
  Constant & & & Hubbell-2001, Egas-2004 \\ \\
  Gaussian & & & Slatkin-1980, Taper-1985,
  Dieckmann-1999\\ \\
  Platykurtic & & &  Leimar-2013 \\ \\
  Offset Gaussian & & & Slatkin-1980, Rummel-1985\\ \\
  ??? & & $1 + \exp(-(x_i + x_j + b)^2) - exp(-b^2)$ & Brown-1987-66 \\ \\
  Exponential & & $\exp(dx^4)$ &Pigolotti-2007, Leimar-2013\\ \\
  Logistic & & & Law-1997, Kisdi-1999, Geritz-1999, Calcagno-2006\\ \\
  Bessel & & & Bolker-2009\\ \\
% more from competition-colonisation literature?
 \multicolumn{4}{l}{\textbf{Kinked}} \\
  Laplacian & & $\exp(-2|x|)$ & Roughgarden-1972, Leimar-2013 \\ \\
  Gaussian with hat & & & Scheffer-2006, Barabas-2013, Leimar-2013 \\ \\
  Asymmetric step & & & Kinzig-1999, Calcagno-2006, DAndrea-2013 \\
  \hline
  \end{tabular}
}
\label{tab:shapes}
\end{table}

\clearpage

\section{Figures}

\begin{figure}[h]
  \centering
  \includegraphics{figures/kernel}
  \caption{Classic text-book view of niche differentiation.  Along the
    x-axis is a resource to be partitioned, such as food or prey size,
    or alternatively a trait axis.  Lines represent hypothetical
    resource utilisation curves for five different species, indicating
    the propensity of that species to use resources of a given size.
    The intensity of competition between two species is indicated by
    the degree of overlap in their resource utilisation
    curves. \citet{MacArthur-1967} proposed that competition would
    limit how closely species could sit relative to one another, via
    the width of the utilisation curve. Soon after it's publication,
    this idea of `limiting similarity` appeared in ecology textbooks,
    with similar figures to the one shown appearing in the earliest
    and also the most recent editions of leading textbooks
    \citep{Begon-1986, Begon-2006, Krebs-1978, Krebs-2013,
      Ricklefs-1973, Ricklefs-1999}.}
  % begon-1986: Fig 7.9, pg 263
  % begon-2006: Fig 8.29, pg 257
  % Krebs-1978: Fig 12.2, pg 233
  % Krebs-2013: ??
  % Ricklefs-1973: Fig. 36.13, pg 525
  % Ricklefs-1999: Fig 29.19, pg 602
  \label{fig:competition-kernels}
\end{figure}

\begin{figure}[h]
 \centering
 \includegraphics{figures/components}
 \caption{Method for estimating the shape the competition function embedded
  in a mechanistic resource-based model. To illustrate the method, we present
  results from a model with known solution \citep{Dieckmann-1999} (see Appendix
  \ref{sec:DD99} for details). For each
  model we estimate: (a) the fitness of a rare invader growing without competition,
  (b) the equilibrium population density of invader when growing in monoculture,
  (c1, c2) the fitness of a rare invader growing in competition with an established
  resident. From these elements, we can estimate the shape of the competition
  function (d1, d2). Panels a-b do not vary with the resident community whereas
  panels c-d may.  As intended the method recovers the Gaussian-shaped competition
  functions assumed by this toy model. Moreover, comparison of panels d1 \& d2
  shows that the shape of the function does not vary with resident trait.}
  \label{fig:components}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/rstar}
  \caption{Shape of competition function embedded within the \Rstar\ model
  for a trait determining the stoichiometry of uptake for two essential resources.
  Here we have only shown the derived  competition functions, see Figs.
  \ref{fig:sm_rstar_components1}-\ref{fig:sm_rstar_components2} for plot of all
  components used to derive these functions.
  Panels a-c show results when consumption of the two resources is symmetric, whereas
  panels d-f show results for an instance when resource 2 is required more than
  resource 1. Panels a \& d show zero-net-growth-isocline (ZNGI) for
  the  model  (solid lines), these are the points at which population growth is zero.
  The series of grey lines are for species differing in the stoichiometry trait.
  The red and blue lines show the ZNGI for a resident species in panels b and
  c, respectively. Panels b-c \& e-f show derived competition functions for a
  community with a single resident at location indicated by the dashed line.
  Solid black lines indicate the competition felt by invading species. Solid
  black bars indicate regions where the invader has positive fitness, i.e.
  could successfully establish. Parameters for the symmetric case, $c_{1i} =
  c_ {2i}=0.5$ and for the asymmetric case $c_{1i} = 0.3, c_ {2i}=0.7$. Resident
  trait values are: (b) 0.6, (c) 0.5, (e) 0.7, (f) 0.9. All other parameters
  are given in Appendix \ref{sec:Rstar}.}
  \label{fig:Rstar}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/plant_hmat}
  \caption{Shape of competition function embedded within \plant\ model for
  the trait height at maturation.
  Here we have only shown the derived  competition functions, see Fig.
  \ref{fig:sm_plant_hmat_components} for plot of all components used to derive these functions.
  Solid lines show the derived competition functions for a community with a
  single resident, whose location is indicated by the dashed line.
  Resident trait values are: (a) XXX, (b) XXX.}
  \label{fig:plant_hmat}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/plant_lma}
  \caption{Shape of competition function embedded within \plant\ model for
  the trait leaf mass per area.
  Here we have only shown the derived  competition functions, see Fig.
  \ref{fig:sm_plant_lma_components} for plot of all components used to derive these functions.
  Solid lines show the derived competition functions for a community with a
  single resident, whose location is indicated by the dashed line.
  Resident trait values are: (a) XXX, (b) XXX.}
  \label{fig:plant_lma}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/plant_lma_density}
  \caption{Density dependence of competition for LMA in plant.  While
    strength of competition varies with traits and is nonlinear with
    density, the pattern of density dependence does not vary strongly
    with traits.  The per-capita competition coefficient is blue when
    stronger than competition is weaker than intraspecific competition
    at equilibrium, red when weaker.  The colour (z) axis following
    the horizontal dotted lines correspond to figure
    \ref{fig:plant_lma}.  As relative population sizes increase, the
    \emph{per-capita} rates of competition decrease, even as the total
    rates of competition ($N \alpha$) increase.  The bottom panels (c
    and d) are competition coefficients \emph{relative} to
    coefficients at equilibrium population size.  The lack of vertical
    strong vertical features indicates that competition strength
    varies fairly uniformly with density across trait space.}
  \label{fig:dd}
\end{figure}

\clearpage

\bibliographystyle{amnat}
\bibliography{references}

\section{Appendices}

\subsection{Details about generic Lotka-Volterra model with
Gaussian competition}\label{sec:DD99}

\citet{Dieckmann-1999} analyse a system following the Lotka-Volterra dynamics
described in equation eq. \ref{eq:LVi}, where maximum growth rate is constant
across species, carrying capacity is a Gaussian
function of the invader trait, and the competition function is a Gaussian
based on the difference between traits of the invader and resident:
\begin{subequations}
\begin{align}
\label{eq:DD}
r(x_I) &= r_0, \\
K(x_I) &= K_0 \exp\left(-\frac{\left(x_I-x_0\right)^2}{2\sigma^2_K}\right),\\
\alpha(x_R, x_I) &= \exp\left(-\frac{\left(x_I-x_R\right)^2}{2\sigma^2_C}\right).
\end{align}
\end{subequations}

For the analyses presented in Figure \ref{fig:components} we let $r_0=1.0$, $K_0=500$,
 $s2_C=1$, and $s2_C=0.16$.

\subsection{Details about \Rstar\ model}\label{sec:Rstar}

The version of the \Rstar\ model here generally follows
\citet{Huisman-2001}, with the parameter trade-offs assumed by
\citet{Fox-2008}.
%
We consider an unstructured system where individuals compete for two
resources. Let $N_i$ be the abundance of species-$i$ and $R_1, R_2$ be
the abundances of the two resources.
%
The change in population size of species $i$ ($N_i$) is:
\begin{equation}
  \label{eq:rstar-n}
  \frac{\ud N_i}{\ud t} = N_i \, (\min(p_{1i}(R_1), p_{2i}(R_2)) - m)
\end{equation}
where $m$ is the mortality rate and where $p_{ji}(R_j)$ is the
specific growth rate of species $i$ given the availability of resource
$j$, $R_j$, and which follows the Monod funtion:
\begin{equation}
  \label{eq:rstar-p}
  p_{ji}(R_j) = \frac{r_i R_j}{U_{ji} + R_j}.
\end{equation}
%
The parameter $U_{ji}$ represents the efficiency of conversion of
resource $j$ into new offspring; the higher $U_{ji}$, the less
resources need to be acquired for a given growth rate.  (Note that $U$
here is $K$ in \citealt{Huisman-2001} but we avoid $K$ to prevent
confusion with carrying capacity in the Lotka--Volterra model.)
%
The dynamics of the resources themselves follow the equations:
\begin{equation}
  \label{eq:rstar-r}
  \frac{\ud R_j}{\ud t} =
  D \times (S_j - R_j) - \sum_{i=1}^n {C_{ji} N_i
    \min(p_{1i}(R_1), p_{2i}(R_2))}
\end{equation}
where $D$ is the resource turnover rate, $S_j$ is the supply rate of
resource $j$ and where the sum is over all species in the community.
% TODO: Do we have a better definition of this?
The term $C_{ji}$ represents the rate of consumption of resouce $j$.

% NOTE: is there anything else about the model we need to detail?
% The carrying capacity, etc, are all analytic.

\subsection{Details about \plant\ model}\label{sec:plant}

Excerpt from  \plant\ model. Hold off writing this until know whether paper describing
the model has been published or not.

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% TeX-PDF-mode: t
%%% End:

Overall shading caused by communities as an alternative way forward:
if all we're tying to predict is whether or not a species can invade
then the low order approximation that an invader does not affect shade
level is OK and equilvanet to invasion fitness.
