\documentclass[a4paper,11pt]{article}
\usepackage[osf]{mathpazo}
\usepackage{ms}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage{caption}
\usepackage[labelfont=bf]{caption} % make label for figure bold

% Allow referencing into the supporting information, once that exists.
\IfFileExists{./competition-kernels-sm.tex}{%
  \usepackage{xr}%
  \externaldocument{competition-kernels-sm}}{}

\title{competition kernels: shapes and consequences}
\author{}
\date{}
\affiliation{}
\runninghead{}
\keywords{}

\usepackage{color}

\input{common-defs}

\begin{document}

% Disable words breaking over lines for final submission:
% \raggedright
% \pagestyle{empty}

% \mstitlepage
\parindent=1.5em
\addtolength{\parskip}{.3em}

% \begin{abstract}
% \end{abstract}

\section{Introduction}

%MW version starting here
Central to community ecology has been the metaphor of species packing. The community is seen as fitted into a volume of niche space. Each species that is a potential community member has a fundamental niche somewhere in the volume. The fundamental niche is compressed by competition into a realised niche, as species are packed in alongside each other (Figure \ref{fig:competition-kernels} for one-dimensional version found in [almost all] textbooks). Roots of the species packing metaphor trace to the competitive exclusion principle (Lotka 1925, Volterra 1926, Gause 1934) whereby if species have identical niches or compete for a single resource, all but one are competitively excluded. Hutchinson (1957) added the n-dimensional hypervolume. The  competitive exclusion principle was converted [inverted? made more quantitative?] into the question how dissimilar two species need to be in order to coexist. This question included "limiting similarity" (MacArthur and Levins 1967) \citep{MacArthur-1967}, and also "character displacement" (Brown and Wilson 1956), the evolution of wider trait differences between species where they coexist. By the 1970s, a new generation of textbooks (Whittaker 1970, Krebs 1972, Ricklefs 1973, Pianka 1974) built their account of community ecology around three alternative ways of getting more species into a community: larger total niche space, more overlap between adjacent niches, or narrower niches for each species [could potentially give page or diagram references here?]. Often, these alternatives were discussed as hypotheses for why there are more species in the tropics compared to the temperate zone.

%MW Haven't yet said anything about the empirical literature looking for overdispersion of traits in communities -- is it important to our Intro, and if so where should it go? Maybe leave till Discussion?

In 1960s theory and 1970s textbooks, niches were typically thought of as utilization functions along a continuous resource axis. The resource in question would be depletable or pre-emptable, in order for overlap of utilization functions to translate into competition. Pairwise competition coefficients (such as alphas in Lotka-Volterra competition) could be calculated from overlap of utilizations functions. If a trait was used as a niche index, it was chosen on grounds of mapping tidily on to a depletable resource, such as beak size for seed-eating finches. Beginning in the 1980s, two different theory strands represented traits more explicitly. One was theory for character (= trait) displacement \citep[e.g.,][]{Taper-1985, Case-2000,   Goldberg-2006}. This flowed on into game theoretical and eventually adaptive-dynamic modeling of trait divergence (Brown 1987, Abrams et al 1993, Geritz et al 1998, 1999, Dieckmann 1999). The other was Tilman's (1982) \Rstar\ model, where the "trait" was the level to which a species could deplete a resource while still sustaining its population. The resource was homogeneous, such as dissolved nitrate in a water body, and this was a distinct break from the formulation of a resource with such as seeds with a continuously varying property such as seed size. Tilman's (1982) model would have a single winner on a single resource (the species with lowest \Rstar), but given two or more resources multiple species could coexist on different ratios between resources.

%MW possibly better to leave \Rstar\ and the nature of coexistence made possible till it is introduced for analysis?

Competition kernels are best thought of within the adaptive-dynamics tradition of fitness landscapes. Species exist, coexist and evolve on a landscape where the axes are evolvable traits. A competition kernel represents the impact of a species on this landscape -- the drawdown of fitness across the landscape as it relates to the trait-values both of the species exerting a competitive effect and of the species experiencing the effect. Competition kernels are absolutely central to the question how species interact in competitive communities. And yet, surprisingly little is known about alternative possible shapes for competition kernels and their consequences for community assembly.

By far the most common type of utilization curve or competition kernel in textbooks and in theoretical literature is that they are unimodal, decreasing with trait-distance away from the species that is exerting the competitive effect. For example Birand (2014) wrote "we assume that the competition function is Gaussian, which is typically assumed in much of the literature (e.g., Dieckmann and Doebeli 1999; Bolnick 2006)".

%MW If we wanted to abbreviate the history, we could maybe at this point go straight to the theory that shows you don't necessarily get species-spacing from gaussian kernels

The species packing metaphor has persisted up to the present day as the mainstream approach to community ecology. (Indeed,  Krebs (6th edn 2009), Ricklefs and Miller (4th edn 2000) and Pianka (6th edition 2000) continue also.) Yet in parallel, three other strands of thinking had already been established by the 1970s.

Terrestrial plant ecology had always found it difficult to accept the idea that different species can only coexist by using different resources, since plant species clearly all use the same sources of light, soil water and mineral nutrients as each other, with only limited opportunities for differentiation by soil depth and by chemical forms of nutrients. One possibility arises from species subdividing a successional-time niche axis in landscapes envisaged as disturbance mosaics (Connell 1978). If plant species make most contribution to their population increase in different years following disturbance, then they certainly are depleting different light and water from each other, and quite possibly different soil nutrients \citep{Huston-1987, Kohyama-1993}.
%[MW -- these refs imported from Rich's notes -- need to check whether they're appropriate for this point].

In a more radical break from subdividing continuous niche axes, models arose that visualised communities as a chessboard of living sites, each able to be occupied by one sessile individual (Yodzis 1979). Coexistence could arise by colonization-competition trade-offs (Levins 1969, Levins and Culver 1971). Where competition is size-asymmetric as in plants competing for light (Harper 1977, Weiner 1990), or where there is advantage to individuals established in territories, as in some coral reef fish, then chance effects in the occupation of vacant living sites can slow competitive exclusion by "lottery" (Sale 1977) or "storage effect" (Chesson and Warner 1981) processes. There have been several theory-lineages within this "sessile dynamics framework" (Fagerstrom and Westoby 1996), and "neutral theory" (Hubbell 2001) also envisions the world as a (very large) chessboard of living sites on which stochastic processes occur.

Another strand of thinking parallel to the species packing metaphor has been ecological strategy theory (e.g. Grime 1974, 1977, 1979, 1988, Southwood 1977, Greenslade 1983). In the best-developed 'CSR' version of this, species were arrayed on a triangle with competition-winning, stress-tolerating and ruderal strategies at the corners. Stress-tolerating included persistence under competition. Predictions arose about the strategy-mixture expected in different physical settings and at different stages of succession (Grime 1979, 2001). Then during the 1990s the suggestion was made to sidestep continuing disputes about the definition of competitiveness by focusing instead on measurable traits and using them as strategy axes (Westoby 1998, Weiher et al 1999, Westoby et al 2002). This suggestion made possible studies of coordination and trade-offs between traits on a worldwide scale (e.g. Wright et al 2004, Moles et al 2005, Zanne et al 2010, Cornwell et al 2014). However, this "trait ecology" has yet to return successfully to the question how species fit together in communities. By being registered on trait axes, competition kernels have the potential to link this world-scale empirical trait ecology back to questions of species assembly into communities.

A third strand of thinking, already established during the 1970s in parallel with the species packing metaphor, was theory showing that with gaussian kernels along a single niche axis, there is in fact no limit to similarity (May 1972, Abrams 1975, 1983). Competitive exclusion can become slow because two competitors are similar in their resource use as well as because they are different. "Continuous coexistence" is a theoretically possible outcome, with resources occupied by many species spaced from each other in resource use by very small amounts. Although this strand of theory might have been expected to undermine the mainstream approach to community ecology via the species packing metaphor, in actuality it did not have the effect of dislodging species packing from standard textbooks, probably because it did not really offer an alternative program for connecting theory to field measurement.  After 2000, this line of theory began to explore more systematically the consequences of possible kernel-shapes for community assembly (Schaffer and van Nes 2006, other literature, Leimar et al 2013).

In summary, the current situation is that it is clear competition kernels on fitness landscapes must be the key to understanding community assembly, and clear also that symmetric unimodal or gaussian kernels are realistic for only a minority of real-world communities. At the same time, the menagerie of possible competition kernels has only begun to be catalogued. Much less have the implications of different kernels for community assembly been worked through. The literature up to the present has mainly been focused on gaussian kernels, perhaps because they were mistakenly thought to be prevalent, or out of fascination with the "continuous coexistence" they can produce. Surprisingly little attention has been paid to the question what shapes are actually likely for competition kernels, given known mechanisms for resource depletion in relation to traits. We argue that clarifying plausible shapes for competition kernels and their consequences will be an essential foundation before a robust community ecology can be constructed.

In this paper we investigate competition kernels that are produced in selected models of growth and reproduction where competition and the mechanics of the resource being depleted are represented mechanistically. In other words, competition kernels are emergent properties from these models, not assumptions adopted into them. In so doing, we
\begin{itemize}
\item
\item introduce standard methods for characterizing competition kernels for any selected model
\item ask what is the shape of the competition function emerging from the model -- Is it Gaussian? Is it symmetric?
\item ask whether the shape of the competition function varies with traits of the resident species
\item ask whether the shape of the competition function varies with density of the resident species
\end{itemize}

\textit{This work is undertaken in the belief that if competition kernels with respect to traits were better understood, this could open a constructive path to}
\begin{itemize}
\item Measure real competition kernels in nature. (Measuring competition as a function of traits rather than between a pair of species may often be difficult in the field, but knowledge of plausible kernel shapes certainly should help.)
\item Predict trait-mixtures. This is arguably intrinsically more powerful than predicting species richness. Moreover, it leads on to the question whether a signature of competition is expected in extant trait-mixtures. If we knew what type of trait-mixture signature should be expected for different mechanisms of competition, that could become a powerful tool for relating theory to real-world communities.
\end{itemize}




%MW bits left over from Rich's notes
Despite their centrality in modelling and ecological thought, models
of competition remain largely unchanged from their original
formulation in the 1960's, with the most popular version due to
\citet{MacArthur-1967}.
% Probably point at the methods here.
Generally species are assumed to interact following the Lotka-Volterra
equations (REFS), with the intensity of competition between two
species ($\alpha_{ij}$) being some function of the two species traits
(for a trait axis $x$, $\alpha_{ij} = \alpha(x_i, x_j)$; see Methods).
%
This formulation implies among other things that competition is linear
in intensity with species abundances, is additive across multiple
competing species, and that the \emph{shape} of competition is an
intrinsic (i.e., not context-dependent) property of pairs of species.
%
While possibly justifiable as low-order approximations, these
assumptions have been widely criticised as long as the models have
been used
\citep[e.g.][]{Andrewartha-1953,May-1972,Abrams-1975}.
%MW question: do we want to cite Andrewartha? -- what is his criticism exactly?
% TODO: I'd love something here where we can report on any attempts to
% measure the *shape* (not intensity) of competition in nature.
%
%MW well there's Georges's work I suppose
The shape of the competition kernel with respect to resources and
species traits has received less attention \citep[but
see][]{Abrams-2008,Leimar-2013}; typically a Gaussian or a form of
$\alpha(x_i, x_j) \propto \exp((x_i - x_j)^4)$ is used, or more rarely
an asymmetric logistic.
%




\section{Models}

% NOTE: Thoughout, decide how to use the terms "competition kernel"
% and "competition function"; in the usual use they are roughly
% equivalent but here they are probably not: see
% http://math.stackexchange.com/questions/22133/difference-between-kernel-and-function

% In the first paragraph, I guess we describe the entire approach as
% well as possible.

We investigated the dynamics of two quite different models -- \plant\ and \Rstar\
-- where the competitive impact of one species on another arises via the
effect of individuals on a shared resource. In each model, species traits
influence the dynamics of resource use and thus competitive interactions. For
each model, we compute the core quantities used in the Lotka-Volterra
equations (growth rate, carrying capacity,  per-capita rate of population
increase) and from that infer the shapes of competition functions.

The standard Lotka-Volterra equations express the per capita rate of increase
in the abundance $N_i$ of species-$i$ as a product of two terms. The first
gives the maximum possible per-capita growth rate $r_i$. The second expresses
the degree to which that maximum is realised, and thus includes any reductions
due to competition with other species. A commonly used form for Lotka-Volterra dynamics
is
\begin{equation}
\label{eq:LV}
\frac{\ud N_i}{\ud t} \frac{1}{N_i} =  r_i \left(1 - \sum_j
                                      \frac{\alpha_{ij} N_j}{K_i}\right),
\end{equation}
where $K_i$ is the equilibrium value for $N_i$ when species-$i$ is grown in a
monoculture  (i.e. carrying capacity), and $\alpha_{ij}$ is the per-capita
competitive effect of species-$j$ on species-$i$. By convention, competition
functions are expressed as the effect of species-$j$ on species-$i$, relative
to the effect of species-$i$ on itself. Thus $\alpha_{ii}\equiv 1$. It is
also worth noting, that there are other forms for eq. \ref{eq:LV}. The alternative
forms differ subtly in the nature of density dependence, but retain the same
overall structure of \ref{eq:LV}, wherein a maximum possible growth rate is multiplied
by a second term incorporating reductions due to competition. For simplicity,
we focus on a single version of the Lotka-Volterra dynamics.

We are interested in situations where the different parameters in eq.
\ref{eq:LV} are functions  of traits. Moreover, we restrict our
attention to situations where a single type with traits
$x_I$ is trying to invade a community comprising a single resident type with
traits $x_R$.  The fitness $f(x_I, x_R)$ of the invading type is
then
\begin{equation}
  \label{eq:LVi}
   f(x_I, x_R) = \frac{\ud N_i}{\ud t} \frac{1}{N_i} =
    r(x_I)\left(1 - \alpha(x_I, x_R) \frac{K(x_R)}{K(x_I)}\right).
\end{equation}
The reason for this narrowing of focus is that it is not possible to
infer the shapes of competition functions in situations with more than one
resident, because the number of unknowns increases faster than the number of
species (refs?).

To estimate the shapes of competition functions embedded within the \Rstar\
and \plant\ models, we use those models to calculate all of the trait-dependent
terms in eq. \ref{eq:LVi} except $\alpha(x_I, x_R)$:
\begin{enumerate}
  \item $f(x_I, x_R)$: fitness of rare invader with traits $x_I$  in competition
  with a established resident with traits $x_R$
  \item $r(x_I)$: maximum possible fitness of invader, i.e. in absence of competition,
  \item $K(x_I)$: equilibrium population density of invader when growing in monoculture.
  \item $K(x_R)$: equilibrium population density of resident when growing in
  monoculture.
\end{enumerate}
We then solved for $\alpha(x_I, x_R)$ by rearranging  \ref{eq:LVi} to give:
\begin{equation}
  \label{eq:alpha}
 \alpha(x_I, x_R) = \frac{K(x_I)}{K(x_R)}
  \left(1 - \frac{f(x_I, x_R)}{r(x_I)}\right).
\end{equation}

\subsection{\Rstar\ model}

% \item As originally formulated, \Rstar\ does not include traits
% \item We adapt a formulation (due to whom?) where a ``trait'' is a
%   measure of specialisation/generalisation.

In the first model (\Rstar) individuals compete for two essential and
depletable resources. This model is one of the best studied and cited models
of resource competition \citep{Tilman-1977, Tilman-1982, Huisman-1999},
originating from a study on exploitative competition for any pair of generic
resources \citep{Leon-1975}. The model is unstructured, with the per capita
growth rates for each species simply depending on the availability of two
resources. We assume both resources are necessary (i.e. non-substitutable), so
the growth rate of each species is determined by the resource which is
currently most limiting. We implemented a version where the specific growth
rates follow a Monod equation \citet{Huisman-1999}, but which is otherwise
similar to the widely-cited implementation by Tilman \citep{Tilman-1977,
Tilman-1982}.  The resource availabilities, in turn, depend on the rates of
resource supply and consumption. Individuals compete with one another by
drawing down the joint resource pools. Such a system is easily described via a
minimal set of equations (Appendix \ref{sec:Rstar}).


Following previous authors \citep{Tilman-1985, Schreiber-2003, Fox-2008} we
focus on a trait determining the relative amount of the two resources
required for growth, i.e. the stoichiometry of resource needs. Species can
vary from requiring mostly resource 1, to equals amounts of both resources, to
mostly resource 2. This dependence is achieved by making uptake saturation
constants (see appendix  \ref{sec:Rstar} for details) for resource 1 inversely related
to the requirement of resource 2:
\begin{equation}
\label{eq:R3}
U_{1i} = 1-U_{2i}.
\end{equation}

\subsection{\plant\ model}

In the second model (\plant) individual plants compete for light within a patch
and size-structured metapopulation \citep{Falster-2011, Falster-2015}.
Vegetation in this model comprises a large number of patches subject to a
prevailing disturbance. Disturbances remove established vegetation within a
patch, which is then recolonised via seed dispersal from other patches.
Individual plants progress through their life-cycle, from seeds until mature
adults, with growth survival and fecundity rates determined by the combined
effect of an individual's traits, its current size and the degree of shading
from other plants within the same patch. The amount of shading at a given
height is computed from the cumulative leaf area above that height; short-term
competitive effects are therefore size-asymmetric. The sole effect of shading
is to alter an individual's photosynthetic income. Following
\citep{Falster-2015}, the fitness of individuals with a given type is
calculated by integrating seed output across the entire metapopulation.

We use the \plant\ model to estimate trait-based competitive functions for
two traits whose evolutionary dynamics have recently been investigated
\citep{Falster-2015}: leaf mass per area (LMA) and height at maturation
(HMAT). In the model, LMA moderates a physiological trade-off between the cost
of building an extra unit of leaf area and the rate of leaf turnover.
Variation in LMA thereby underpins a trade-off between height growth rate and
shade-tolerance of seedlings. Meanwhile, HMAT moderates the allocation of
surplus energy between growth and seed production, as an individual increases in
size.

% TODO: Something about how hmat leads to a fundamentally asymmetric
% competition situation? -- i.e., talk about the *expectations* for
% the different models.

\clearpage

\section{Results}

% For each model there are a few things to discuss:
%
% - Non-equilibrium before equilibrium
% - Density dependence after discussing each model
% - Different measures of competition (where?)

\subsection{\Rstar}

For the \Rstar\ model we consider two cases: a ``symmetric
consumption'' case with $C = \{0.2, 0.2\}$ and an ``asymmetric case''
with $C = \{0.3, 0.7\}$.  Species vary only in their rate of resource
conversion efficiency and the degree in which they specialise in the
two resources.  For each case, we consider two resident communities;
one in a position where invasion by other types is possible and one at
the evolutionary optimum point.
%
Because $C$ does not vary by species, coexistence is not possible in
this model \citep{Tilman-1982}; invasion is a sufficient condition for
competitive replacement.

In the symmetric model, we first consider a resident at $x = 0.6$
(midway between pure generalist and pure specialist on resource B).
%
The resident species competes strongly with species that are more
specialised than itself (self competition is $\alpha(x, x) \equiv
1$), while invaders that were less specialised (i.e., closer to $x =
0.5$ than the resident) experienced less competition from the resident
than it exerted on itself (Figure \ref{fig:Rstar}b).
%
The region of competition $< 1$ lines up perfectly with the region
where invasion is possible (black bar on Figure \ref{fig:Rstar}b,
fitness greater than zero on Figure
\ref{fig:sm_rstar_components1}c1).
%
When the resident is moved to $x = 0.5$ (perfectly generalist) then
invasion is not possible for any type.  In this case, the strength of
competition increases monotonically away from the resident.
%
Computing competition functions using the derivative approach
described in \citet{Abrams-2008}
($(\partial d_i / \partial N_j) / (\partial d_i / \partial N_i) |_{N_i
  = 0, N_j = K_j}$)
was qualitatively similar, though picewise linear in species traits
and with higher departure from 1.

In the asymmetric case, consumption rates are higher for
resource $B$ than resource $A$; this shifts the model in favour of
species that can most efficiently use resource $B$.
%
With a single resident at $x = 0.7$, invasion is possible for species
that use $B$ more efficiently ($x$ in $(0.7, \approx 0.99)$).
%
The shape of the competition function was considerably more
complicated than the symmetric case, though the region of invasion
still corresponded to the region where competition was less than 1.

In both the symmetric and asymmetric case, competition was density
dependent.  Increasing the resident density changes the per-capita
competitive impact (this is not the case for models like the
\citet{Dieckmann-1999} model where the per-capita competitive effect
stays constant).
%
In the symmetric model, the \emph{shape} did not qualitatively change,
and competition was always saturating with increasing density.
Increasing species density decreased the per-capita competitive effect
(Figure \ref{fig:rstar_density_dependence}a--b).
%
In the asymmetric model, the shape of competition qualitatively
changed, though on average per-capita competition appeared to decrease
with increaing density (Figure
\ref{fig:rstar_density_dependence}c--d).

\subsection{\plant: hmat}

In the \plant\ model, Strategies that have different height of
maturation (\hmat) begin to focus resources on reproduction at
different ages.  Plants that reproduce earlier get to ``lock in''
reproduction, but because they allocate less resources to growth they
risk being over-topped and out-shaded by strategies that reproduce
later.  This leads to a strongly asymmetric competitive effect of
taller strategies suppressing the population growth of shorter
strategies.

We recover competition functions that are asymmetric in this case:
strategies exert more competition on species that are shorter than
them than are taller than them (Figure \ref{fig:plant_hmat}).  As the
resident strategy increases in size, the strength of competition felt
by smaller species increases, and the slope of this competitive effect
increases (compare panels \textit{a} and \textit{b} in Figure
\ref{fig:plant_hmat}.
%
Despite the consistent direction of competition, invasion depends on
the interaction between competitive effect, carrying capacity and
maximum growth rate; in the presence of a short resident, taller
strategies can invade (Figure \ref{fig:sm_plant_hmat_components}\,c1),
while in the presence of a tall resident, shorter strategies can
invade (Figure \ref{fig:sm_plant_hmat_components}\,c2).

This property is very similar to other models of asymmetric
competition \citep[e.g.,][]{Kisdi-1999}, where selection pushes traits
to an ``branching point'' (close to the resident in (Figure
\ref{fig:sm_plant_hmat_components}c2), and then repeated invasion to
the left of this point is possible.
% TODO: SM figure showing the equilibrium community for each of the
% scenarios presented (#31).
Even though the shape of the function is not exactly sigmoidal, the
evolutionary dynamics are similar (\TODO).
% TODO: Run out the evolutionary dynamics of plant/hmat and Kisdi to
% show that things do actually look similar with continual reinvasion
% of mutants to the left.
% TODO: density dependence
% TODO: Abrams kernel calculation

\subsection{\plant: lma}
Strategies that have different leaf mass per unit area (\textsc{lma})
values are different points in the ``leaf economic spectrum''
\citep{Reich-1997,Wright-2004}.  We modelled LMA as a trade-off
between the cost of deploying a unit of cost of building an extra unit
of leaf area and the rate of leaf turnover (so high LMA leaves are
costly to deploy but turn over more slowly so that they can contribute
to carbon gain for longer, or conversely require rebuilding less
often).

The shape of the competition function is complex and does not conform
to any of the simple shapes in wide use.
% Need to be clear that we're talking about the non attractor
% situation first.
In the region of trait space close to the resident species,
competition is strongly asymmetric: the resident exerts a large amount
of competition on species with LMA values higher than itself (``slow''
strategy species) and less on species that have LMA values lower
(``fast'' strategy species; Figure \ref{fig:plant_lma}a).  Invasion is
possible in the region with LMA values smaller than the invader until
growth and carrying capacity reach a biological limit to invasion
(Figure \ref{fig:sm_plant_lma_components}c1).
%
Above the resident LMA value, the competition function is sawtooth
shaped, before eventually declining steeply.
%
In contrast to the complex shape of fitness and competition, maximum
growth rate has a simple form and carrying capacity is approximately
Gaussian (Figure \ref{fig:sm_plant_lma_components}\,a and b).

Moving the resident towards the evolutionary attractor, invasion is
possible through a broad range of trait values (both avove and below
the resident value).
%
Make the case that the sawtoothness \textbf{probably} corresponds to
differences in how time is partitioned (\TODO).
%
Explain how is it the case that invasion is possible through the
region where competition $\approx 1$ -- that doesn't make much sense!
It's similar to the situation with \hmat\ though (\TODO).

\clearpage
\section{Discussion}

We inferred the shape of trait-based competition functions embedded within
two mechanistic models of resource competition, focussing on the special (but
important) case of a single resident preventing or allowing invasion of a new
phenotype by competing with it. In the models we looked at, the competition
functions: i) were density dependent, implying non-linear per-capita
competitive effects \citep{Abrams-1980}; ii) varied qualitatively and
quantitatively with resident phenotype, implying that they are not actually
kernels but functions, and iii) had shapes that were distinctly non-Gaussian,
suggesting limited connection with the wide array of theoretical models
assuming Gaussian shapes. Trivially, our results demonstrate that the \Rstar\
and \plant\  models are not well approximated by a Lotka-Volterra system, at
least for two of the three traits we investigated. This fact alone is not
surprising: it should certainly be hoped that more complex resource-based models
are in some way richer that the standard LV equations. Moreover, we are in
some cases simply reaffirming known shortcomings of LV systems for capturing
important features of biological systems (REFS). More substantially, the
departure in the derived competition functions from the Gaussian kernels
assumed by most theoretical investigations is so drastic, it is difficult to
reconcile the two approaches. All purport to give insights into the mechanisms
of community assembly via competition for resources. Yet, there seems no
straightforward way of interpreting the results from the resource-based
models, for two of the three traits investigated, within the known behaviour
of LV systems. This perhaps suggest that we have been focussing our
theoretical investigations on an unnecessarily restricted region of possible
model space.

\subsection{Competition functions in our plant models are anything but fixed 
Gaussian kernels}

In only one of the three cases studied here did our derived competition
functions closely resemble any of the three dominant curves used in most
theoretical investigations. The common forms are the Gaussian, asymmetric
Gaussian \citet{Roughgarden-1979} and Logistic  \citep[e.g.][]{Kisdi-1999,
Law-1997}. The derived function from the HMAT model looks a lot
like the logistic kernels used in models investigating asymmetric competition
\citep{Kisdi-1999, Law-1997}.  An asymmetric kernel is also implicit in
the widely used competition-colonisation models  \citep{Geritz-1999,
Calcagno-2006}, which can be reformulated in form of LV system
\citep{Calcagno-2006}. The competition function for our LMA model looks
vaguely resembles the asymmetric Gaussian, but the ridges along the top are
distinctly non-Gaussian and arise from real biological features of the system. 
(\citet{Falster-2011} showed how the amount of shading undulates through 
successional time. here this translates into undulations in fitness with
respect to traits.) It is hard to generalise about these findings; what we
can say is that none of the functions even closely resemble straight Gaussian
kernels. 

We also found that, for all three of the models, the derived competition
functions were density dependent. It was not only the amplitude of the
function that changed, but also its \emph{shape} (Figs xx). This result was
predicted by \citet{Abrams-1980}, who argued that not satisfying the implicit
of LV dynamics would lead to widespread non-constant density dependence. The
idea that competitive effects are non-linear in density (i.e. non additive) is
widely established within other more empirical realms of plant ecology, e.g.
in the self thinning law \citep{Westoby-1984}, and the law of constant final
yield \citep{Weiner-2010}. In both cases, the dynamics mirror are similar to
those we observe: initially effects in either biomass or competition increase with population
density (as would be expected with a constant per capita effect), but then
once a saturating population density has been reached, addition of more seed
has little impact on the community. As such, the per-capita effects changed
sharply with density. (Do we have more to list ??). Similar findings
exist for animals: already by 1980 there were  multiple reports showing that
competition coefficients were not independent of population density
\citep{Abrams-1980}.

One of the primary reasons we used models to study the shapes of competition
functions was due the difficulty of estimating these in the field.
Interestingly, \citet{Ricklefs-1973} suggests one might use the exact  method
we have applied to estimating competition functions, i.e. by measuring the
different elements of eq. \ref{eq:LVi} then using these to estimate the
competitive interaction (Fig. \ref{fig:components}). And indeed some
estimates have been made \citep{Ricklefs-1973}. However, nearly all
manipulative measures of competition in the field are going to give
\emph{discrete} estimates of $\alpha$: the amount of competition exerted by
or felt by a single species in the context of some community. However, as
the number of species increases, the number of pairwise competition
coefficients needed increases quadratically with the number of species. This is
one reason for seeking to define competition kernels on the basis of
trait differences, so as to reduce the number of parameters needed (refs).
However, estimating the shapes of trait-based competition kernels requires
that lots of pairwise comparisons to made, which introduces new issues.
Species usually differ in multiple traits, plus the need to estimate fitness
across the life-cycle makes the task nigh impossible. Models are attractive
because they allow us to rune experiments in ways that are simply not
possible in real systems. 

\subsection{Suitability of LV as a basis for modelling biological phenomena}

Together, our findings imply the deeply ingrained assumption that
competition kernels can be defined by differences in trait values
alone -- without reference to population size, or absolute value of traits
-- is simply not defensible for the resource-based competition in plant
communities. And by implication, the notion that a fixed competition
coefficient exists as a property between two species surely also 
disintegrates. This raises the question of whether we should be seeking to
revise our ideas about competition kernels, or more generally about the
usage LV equations as a foundation for modelling biological phenomena.

It is certainly possible to expand the idea of a competition kernel to be a
function not only of trait differences, but also of population density and
species traits. The consequence of including functions of this type in
traditional analyses about species-coexistence and character displacement are
simply unknown. However, such an approach would only work if the competition
functions derived from pairs of species could still be added to get the effect
of an entire resident community on a potential invader. Our results suggest it
such additivity is unlikely (Figs. ???). So in that case the competition
kernel would be a function of the entire resident community, perhaps operating
via the resource densities. At that point we are perhaps stretching he concept
beyond its useful limit. We may as well just use a model with explicit
handling of resources.

The problems with competition kernels also suggest the very framework we are
using to model species interactions -- the LV system -- is inadequate. The
LV equations were proposed in the 1920s \citep{Volterra-1928}


Difficult to link with traits

Size-structure vs unstructured

See notes in wiki:
"github.com/richfitz/competition-kernels/wiki/Literature:-problems"

\subsection{Expanding the possibilities for coexistence in models}

Kernels other than Gaussian may lead to coexistence more easily
  than Gaussian

\begin{itemize}
\item It's not all bad news; kernels like the LMA kernel look
  ridiculous and you're not going to be allowed to propose them for
  a modelling paper.
\item But they arise from size-structured dynamics in the model, so
  may not be that uncommon (worth noting that almost all the models
  are really of discrete exchangeable adults and that size/age
  structure was flagged as an issue ages ago but I've lost the
  paper).
\end{itemize}


\subsection{Bridging the gap between different theory strands and 
empirical work}

\textit{Deriving macroscopic approximations of detailed models}

\begin{itemize}
 \item This is not meant to be a criticism of simple models \textit{per
  se}; simple models are essential to ecology, and there are many
  reasons to model competition and anything much more complicated than
  Gaussian kernels quickly becomes intractable.  More concerning is
  that we don't have a strong idea about how departures from the
  Gaussian kernel will impact models of coexistence or of other models
  for which competition is a key ingredient.  There is some quite
  theoretical work on this (e.g. some recent Doebeli work), but it's
  still a long way removed from the weird shapes here.
\item Ideally we can identify features that mechanistic models, models
  with implicit competition, and empirical data have in common and make
  sure that our models that invoke explicit competition are robust to
  these features
\item History of deriving higher-level approximations to detailed models. 
\end{itemize}

\textit{Traits are a productive way forward -- for what?}

\begin{itemize}
\item What did we want to say here, really?  Traits are already how
  people are thinking about kernels, but the work on resources hasn't
  caught up (see last point)
\item In a way, we're arguing to turn the way that we've looked at
  competition around: rather than asking ``given we know species
  coexist, what do we have to do to competition kernels'', we're
  saying: ``given we have data on species traits, can we just look at
  the shapes that competition functions actually take and use that to
  guide future modelling''.
\end{itemize}


\textit{Trait-resource utility linkage is important, but largely
  ignored.  Mechanistic models provide some sort of way forward.}

\begin{itemize}
\item lma - time is resource
\item Of course we don't actually make this link in the model --
  perhaps we should
\item The 1:1 mapping happened very quietly, but the resource axis has
  gradually been entirely replaced by trait axes.  We argue that
  neither are likely to exhibit behaviour like the
  \citet{MacArthur-1967} model in natural systems.
\item There is a shift in the 1980s from modelling limiting
  similarity in terms of resources to modelling trait
  divergence/convergence and disruptive selection.
  \begin{itemize}
  \item Begins with \citet{Taper-1985} and \citet{Brown-1987-140}; these
    make explicit a direct 1:1 trait:resource mapping implied by the
    previous models.
  \item Continued as the models were used in adaptive dynamics
    \citep[e.g.,][]{Dieckmann-1999} and then picked up by physicists
    \citep[e.g.,][]{Leimar-2013}
  \item For vertebrate animals, this connection has always been fairly
    defensible for the sorts of traits people think about (e.g., finch
    beak size --- Lack), but for plants the resource axis is hard: most
    plants would rather more light.  Shifting to traits with some
    complicated non-linear map between traits and resources offers a way
    forward, though it makes the links to resources and underlying
    process muddier.
  \end{itemize}
\item It's hard to bridge between abstract models of competition that
  inform most theory with the sort of traits and species data that we
  have for plant communities.
\item Modelling competition on shorter time frame - e.g. in growth or
survival process rather than lifetime fitness. 
\end{itemize}

\subsection{Conclusions, where next with models of competition?}

\emph{"The nearly complete dependence of theoretical community ecology on a
limited number of simple models has resulted in the development of subsequent
generations of deceptively simple constructs that may often confuse our
understanding of the underlying biology rather than improve it. The 
Lotka-Volterra competition equations and the community matrix are one such 
pair of constructs."} \citep{Neill-1974}

\begin{itemize}
\item Despite being difficult to quantify in the field and relate to
  models, competition is likely an important force in structuring
  communities.
\item If competition is density dependent, non-additive and if the
  shape of competition varies with species traits and not just
  distance, then the Lotka-Volterra equation will be inadequate to
  capture dynamics of real systems --- this is is not a new criticism
  \citep[e.g., see][: ``The nearly complete dependence of theoretical
  community ecology on a limited number of simple
  models'']{Neill-1974}
\item It's difficult see what a new set of equations would look like.
  Clearly we need to move from LV, but some other decomposition of
  species fitness as functions of species traits might help.
\item \textit{This is where we might foreshadow some of the work with
    Alistair?}
\end{itemize}

% Other ported notes:
% \item The \Rstar\ model is formulated with the same ingredients as LV
%   but gives totally different results.  This is a concern if the most
%   commonly used models of explicit and implicit competition do not
% \item Kernels such as the LMA one may promote coexistence in ways that
%   are totally different from the models based on the Gaussian
%   kernels.  As such, thinking narrowly about competition facilitating
%   coexistence in this way may be misleading.
% \item The arguments about limiting similarity are probably very
%   sensitive to the assumptions about constant per-capita rate of
%   competition.  If competition increases or decreases with the density
%   of species, this should affect how closely they can pack.  These
%   ideas have previously been explored by Abrams I believe.
% \item If we let $r$ and $K$ vary with species traits and let
%   $\alpha(x, y)$ vary with traits and densities in an arbitrary way,
%   do we hae anything tractable?  Is this just saying ``it's all
%   hopeless''?  Are there simple LV-style models we could possibly come
%   up with that mimic complex models or realistic situations in ways
%   that make any sense?
%   agree.
% \item This is not meant to be a criticism of simple models \textit{per
%     se}; simple models are essential to ecology, and there are many
%   resons to model competition and anything much more complicated than
%   Gaussian kernels quickly becomes intractable.  More concerning is
%   that we don't have a strong idea about how departures from the
%   Gaussian kernel will impact models of coexistence or of other models
%   for which competition is a key ingredient.  There is some quite
%   theoretical work on this (e.g. some recent Doebeli work), but it's
%   still a long way removed from the weird shapes here.
% \item Ideally we can identify features that mechanistic models, models
%   with implicit competition, and empirical data have in common and make
%   sure that our models that invoke explicit competition are robust to
%   these features.
% \item Can measuring competition in mechanistic models help
%   bridge theory and data? May help interpret data from non-manipulative
%   estimation of competition intensity (e.g., Georges' work).

\clearpage

\section{Figures}

\begin{figure}[h]
  \centering
  \includegraphics{figures/kernel}
  \caption{Classic text-book view of niche differentiation.  Along the
    x-axis is a resource to be partitioned, such as food or prey size,
    or alternatively a trait axis.  Lines represent hypothetical
    resource utilisation curves for five different species, indicating
    the propensity of that species to use resources of a given size.
    The intensity of competition between two species is indicated by
    the degree of overlap in their resource utilisation
    curves. \citet{MacArthur-1967} proposed that competition would
    limit how closely species could sit relative to one another, via
    the width of the utilisation curve. Soon after it's publication,
    this idea of `limiting similarity` appeared in ecology textbooks,
    with similar figures to the one shown appearing in the earliest
    and also the most recent editions of leading textbooks
    \citep{Begon-1986, Begon-2006, Krebs-1978, Krebs-2013,
      Ricklefs-1973, Ricklefs-1999}.}
  % begon-1986: Fig 7.9, pg 263
  % begon-2006: Fig 8.29, pg 257
  % Krebs-1978: Fig 12.2, pg 233
  % Krebs-2013: ??
  % Ricklefs-1973: Fig. 36.13, pg 525
  % Ricklefs-1999: Fig 29.19, pg 602
  \label{fig:competition-kernels}
\end{figure}

\begin{figure}[h]
 \centering
 \includegraphics{figures/components}
 \caption{Method for estimating the shape the competition function embedded
  in a mechanistic resource-based model. To illustrate the method, we present
  results from a model with known solution \citep{Dieckmann-1999} (see Appendix
  \ref{sec:DD99} for details). For each
  model we estimate: (a) the fitness of a rare invader growing without competition,
  (b) the equilibrium population density of invader when growing in monoculture,
  (c1, c2) the fitness of a rare invader growing in competition with an established
  resident. From these elements, we can estimate the shape of the competition
  function (d1, d2). Panels a-b do not vary with the resident community whereas
  panels c-d may.  As intended the method recovers the Gaussian-shaped competition
  functions assumed by this toy model. Moreover, comparison of panels d1 \& d2
  shows that the shape of the function does not vary with resident trait.
  \label{fig:components}}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/rstar}
  \caption{Shape of competition function embedded within the \Rstar\ model
  for a trait determining the stoichiometry of uptake for two essential resources.
  Here we have only shown the derived  competition functions, see Figs.
  \ref{fig:sm_rstar_components1}-\ref{fig:sm_rstar_components2} for plot of all
  components used to derive these functions.
  Panels a-c show results when consumption of the two resources is symmetric, whereas
  panels d-f show results for an instance when resource 2 is required more than
  resource 1. Panels a \& d show zero-net-growth-isocline (ZNGI) for
  the  model  (solid lines), these are the points at which population growth is zero.
  The series of grey lines are for species differing in the stoichiometry trait.
  The red and blue lines show the ZNGI for a resident species in panels b and
  c, respectively. Panels b-c \& e-f show derived competition functions for a
  community with a single resident at location indicated by the dashed line.
  Solid black lines indicate the competition felt by invading species. Solid
  black bars indicate regions where the invader has positive fitness, i.e.
  could successfully establish. Parameters for the symmetric case, $c_{1i} =
  c_ {2i}=0.5$ and for the asymmetric case $c_{1i} = 0.3, c_ {2i}=0.7$. Resident
  trait values are: (b) 0.6, (c) 0.5, (e) 0.7, (f) 0.9. All other parameters
  are given in Appendix \ref{sec:Rstar}.
  \label{fig:Rstar}}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/plant_hmat}
  \caption{\textbf{Shape of competition function embedded within \plant\ model for
  the trait height at maturation.}
  Here we have only shown the derived  competition functions, see Fig.
  \ref{fig:sm_plant_hmat_components} for plot of all components used to derive these functions.
  Solid lines show the derived competition functions for a community with a
  single resident, whose location is indicated by the dashed line.
  Resident trait values are: (a) XXX, (b) XXX.
  \label{fig:plant_hmat}}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics{figures/plant_lma}
  \caption{\textbf{Shape of competition function embedded within \plant\ model for
  the trait leaf mass per area.}
  Here we have only shown the derived  competition functions, see Fig.
  \ref{fig:sm_plant_lma_components} for plot of all components used to derive these functions.
  Solid lines show the derived competition functions for a community with a
  single resident, whose location is indicated by the dashed line.
  Resident trait values are: (a) XXX, (b) XXX.
  \label{fig:plant_lma}}
\end{figure}

\begin{figure}[h]
  \centering
  % \includegraphics{figures/plant_lma}
  \caption{\textbf{Density dependence
  ...}.
  \label{fig:dd}}
\end{figure}


\clearpage

\bibliographystyle{amnat}
\bibliography{references}

\section{Appendices}

\subsection{Details about generic Lotka-Volterra model with
Gaussian competition}\label{sec:DD99}

\citet{Dieckmann-1999} analyse a system following the Lotka-Volterra dynamics
described in equation eq. \ref{eq:LVi}, where maximum growth rate is constant
across species, carrying capacity is a Gaussian
function of the invader trait, and the competition function is a Gaussian
based on the difference between traits of the invader and resident:
\begin{subequations}
\begin{align}
\label{eq:DD}
r(x_I) &= r_0, \\
K(x_I) &= K_0 \exp\left(-\frac{\left(x_I-x_0\right)^2}{2\sigma^2_K}\right),\\
\alpha(x_I, x_R) &= \exp\left(-\frac{\left(x_I-x_R\right)^2}{2\sigma^2_C}\right).
\end{align}
\end{subequations}

For the analyses presented in Figure \ref{fig:components} we let $r_0=1.0$, $K_0=500$,
 $s2_C=1$, and $s2_C=0.16$.

\subsection{Details about \Rstar\ model}\label{sec:Rstar}

We consider an unstructured system where individuals compete for two
resources. Let $N_i$ be the abundance of species-$i$ and $R_1, R_2$ be the
abundances of the two resources. The population of species-$i$ increases with
per-capita
growth rate $\mu_i(R_1,R_2)$, a function of the resource availabilities, and
decreases with per-capita mortality rate $m$. Species-$i$ depletes resource-$k$
at rate $c_{ki} \,  N_i \, \mu_i(R_1,R_2)$, where $k = 1, 2$ and $c_{ki}$ is
the content of resource-$k$ in species-$i$. Resources
are replenished
with supply rate $S_k$ and decay at rate $D_k$. Under these assumptions, the
dynamics of species and resource abundance are given by
\begin{subequations}
  \begin{align}
\label{eq:R1}
\frac{dN_i}{dt} &= N_i \, \mu_i(R_1,R_2) - N_i \, m \\
\frac{dR_k}{dt} &= D \, (S_k- R_k) - \sum_{i=1}^{n}{c_{ki} \, N_i \,
  \mu_i(R_1, R_2)},
\end{align}
\end{subequations}
where $n$ is the number of species and $k=1,2$ is the number of resources.

The birth rate $\mu$ for each species are assumed to follow a Monod equation,
and be determined by the resource which is most limiting, such that
\begin{equation}
\label{eq:R2}
\mu_i(R_1, R_2) = r_i \, \min \left(\frac{R_1}{U_{1i} + R_1},
                                    \frac{R_2}{U_{2i} + R_2} \right).
\end{equation}
% NOTE: In above equation `U` was previously labelled `K`. I suggest we use U
% over K because K is already used in the Lotka Volterra equations, so reusing
% same symbol here is likely to cause confusion.
In eq. \ref{eq:R2}, $r_i$ is the maximal growth rate rate of species $i$, $U_
{ki}$ is the half saturation constant for species-$i$limited by resource $k$.

\subsection{Details about \plant\ model}\label{sec:plant}

Excerpt from  \plant\ model. Hold off writing this until know whether paper describing
the model has been published or not.

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% TeX-PDF-mode: t
%%% End:

Overall shading caused by communities as an alternative way forward:
if all we're tying to predict is whether or not a species can invade
then the low order approximation that an invader does not affect shade
level is OK and equilvanet to invasion fitness.
